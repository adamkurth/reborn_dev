

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray &mdash; bornagain 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../../search.html"/>
    <link rel="top" title="bornagain 0.0.1 documentation" href="../../../../../../index.html"/>
        <link rel="up" title="bornagain.external.pyqtgraph.pyqtgraph" href="../../pyqtgraph.html"/> 

  
  <script src="../../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> bornagain
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../bornagain.html">bornagain package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../modules.html">bornagain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../coding.html">Coding guidlines for developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">bornagain</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pyqtgraph.html">bornagain.external.pyqtgraph.pyqtgraph</a> &raquo;</li>
        
      <li>bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MetaArray.py -  Class encapsulating ndarray with meta data</span>
<span class="sd">Copyright 2010  Luke Campagnola</span>
<span class="sd">Distributed under MIT/X11 license. See license.txt for more infomation.</span>

<span class="sd">MetaArray is an array class based on numpy.ndarray that allows storage of per-axis meta data</span>
<span class="sd">such as axis values, names, units, column names, etc. It also enables several</span>
<span class="sd">new methods for slicing and indexing the array based on this meta data. </span>
<span class="sd">More info at http://www.scipy.org/Cookbook/MetaArray</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">types</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">reduce</span>
<span class="c1">#import traceback</span>

<span class="c1">## By default, the library will use HDF5 when writing files.</span>
<span class="c1">## This can be overridden by setting USE_HDF5 = False</span>
<span class="n">USE_HDF5</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">h5py</span>
    <span class="n">HAVE_HDF5</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">USE_HDF5</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">HAVE_HDF5</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="axis"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.axis">[docs]</a><span class="k">def</span> <span class="nf">axis</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience function for generating axis descriptions when defining MetaArrays&quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cNameOrder</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
    <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">col</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)):</span>
                <span class="n">col</span><span class="p">[</span><span class="n">cNameOrder</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="sliceGenerator"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.sliceGenerator">[docs]</a><span class="k">class</span> <span class="nc">sliceGenerator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Just a compact way to generate tuples of slice objects.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arg</span>
    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arg</span></div>
<span class="n">SLICER</span> <span class="o">=</span> <span class="n">sliceGenerator</span><span class="p">()</span>
    

<div class="viewcode-block" id="MetaArray"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray">[docs]</a><span class="k">class</span> <span class="nc">MetaArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;N-dimensional array with meta data such as axis titles, units, and column names.</span>
<span class="sd">  </span>
<span class="sd">    May be initialized with a file name, a tuple representing the dimensions of the array,</span>
<span class="sd">    or any arguments that could be passed on to numpy.array()</span>
<span class="sd">  </span>
<span class="sd">    The info argument sets the metadata for the entire array. It is composed of a list</span>
<span class="sd">    of axis descriptions where each axis may have a name, title, units, and a list of column </span>
<span class="sd">    descriptions. An additional dict at the end of the axis list may specify parameters</span>
<span class="sd">    that apply to values in the entire array.</span>
<span class="sd">  </span>
<span class="sd">    For example:</span>
<span class="sd">        A 2D array of altitude values for a topographical map might look like</span>
<span class="sd">            info=[</span>
<span class="sd">        {&#39;name&#39;: &#39;lat&#39;, &#39;title&#39;: &#39;Lattitude&#39;}, </span>
<span class="sd">        {&#39;name&#39;: &#39;lon&#39;, &#39;title&#39;: &#39;Longitude&#39;}, </span>
<span class="sd">        {&#39;title&#39;: &#39;Altitude&#39;, &#39;units&#39;: &#39;m&#39;}</span>
<span class="sd">      ]</span>
<span class="sd">        In this case, every value in the array represents the altitude in feet at the lat, lon</span>
<span class="sd">        position represented by the array index. All of the following return the </span>
<span class="sd">        value at lat=10, lon=5:</span>
<span class="sd">            array[10, 5]</span>
<span class="sd">            array[&#39;lon&#39;:5, &#39;lat&#39;:10]</span>
<span class="sd">            array[&#39;lat&#39;:10][5]</span>
<span class="sd">        Now suppose we want to combine this data with another array of equal dimensions that</span>
<span class="sd">        represents the average rainfall for each location. We could easily store these as two </span>
<span class="sd">        separate arrays or combine them into a 3D array with this description:</span>
<span class="sd">            info=[</span>
<span class="sd">        {&#39;name&#39;: &#39;vals&#39;, &#39;cols&#39;: [</span>
<span class="sd">          {&#39;name&#39;: &#39;altitude&#39;, &#39;units&#39;: &#39;m&#39;}, </span>
<span class="sd">          {&#39;name&#39;: &#39;rainfall&#39;, &#39;units&#39;: &#39;cm/year&#39;}</span>
<span class="sd">        ]},</span>
<span class="sd">        {&#39;name&#39;: &#39;lat&#39;, &#39;title&#39;: &#39;Lattitude&#39;}, </span>
<span class="sd">        {&#39;name&#39;: &#39;lon&#39;, &#39;title&#39;: &#39;Longitude&#39;}</span>
<span class="sd">      ]</span>
<span class="sd">        We can now access the altitude values with array[0] or array[&#39;altitude&#39;], and the</span>
<span class="sd">        rainfall values with array[1] or array[&#39;rainfall&#39;]. All of the following return</span>
<span class="sd">        the rainfall value at lat=10, lon=5:</span>
<span class="sd">            array[1, 10, 5]</span>
<span class="sd">            array[&#39;lon&#39;:5, &#39;lat&#39;:10, &#39;val&#39;: &#39;rainfall&#39;]</span>
<span class="sd">            array[&#39;rainfall&#39;, &#39;lon&#39;:5, &#39;lat&#39;:10]</span>
<span class="sd">        Notice that in the second example, there is no need for an extra (4th) axis description</span>
<span class="sd">        since the actual values are described (name and units) in the column info for the first axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>

    <span class="c1"># Default hdf5 compression to use when writing</span>
    <span class="c1">#   &#39;gzip&#39; is widely available and somewhat slow</span>
    <span class="c1">#   &#39;lzf&#39; is faster, but generally not available outside h5py</span>
    <span class="c1">#   &#39;szip&#39; is also faster, but lacks write support on windows</span>
    <span class="c1"># (so by default, we use no compression)</span>
    <span class="c1"># May also be a tuple (filter, opts), such as (&#39;gzip&#39;, 3)</span>
    <span class="n">defaultCompression</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1">## Types allowed as axis or column names</span>
    <span class="n">nameTypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">basestring</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>
<div class="viewcode-block" id="MetaArray.isNameType"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.isNameType">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">isNameType</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">nameTypes</span><span class="p">])</span></div>
        
        
    <span class="c1">## methods to wrap from embedded ndarray / HDF5 </span>
    <span class="n">wrapMethods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;__eq__&#39;</span><span class="p">,</span> <span class="s1">&#39;__ne__&#39;</span><span class="p">,</span> <span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="s1">&#39;__gt__&#39;</span><span class="p">])</span>
  
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#self._infoOwned = False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isHDF</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;readAllData&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File read failed: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">info</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;implements&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_info</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1">## create empty array with specified shape</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="n">copy</span><span class="p">)</span>

        <span class="c1">## run sanity checks on info structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkInfo</span><span class="p">()</span>
    
<div class="viewcode-block" id="MetaArray.checkInfo"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.checkInfo">[docs]</a>    <span class="k">def</span> <span class="nf">checkInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>
        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)]</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Info must be a list of axis specifications&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">info</span><span class="o">.</span><span class="n">extend</span><span class="p">([{}]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Info parameter must be list of length ndim+1 or less.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Axis specification must be Dict or None&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">and</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Axis values must be specified as list or ndarray&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Values array for axis </span><span class="si">%d</span><span class="s2"> has incorrect shape. (given </span><span class="si">%s</span><span class="s2">, but should be </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">str</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">],))))</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">and</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Length of column list for axis </span><span class="si">%d</span><span class="s1"> does not match data. (given </span><span class="si">%d</span><span class="s1">, but should be </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span></div>
   
<div class="viewcode-block" id="MetaArray.implements"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.implements">[docs]</a>    <span class="k">def</span> <span class="nf">implements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">## Rather than isinstance(obj, MetaArray) use object.implements(&#39;MetaArray&#39;)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;MetaArray&#39;</span></div>
    
    <span class="c1">#def __array_finalize__(self,obj):</span>
        <span class="c1">### array_finalize is called every time a MetaArray is created </span>
        <span class="c1">### (whereas __new__ is not necessarily called every time)</span>
        
        <span class="c1">### obj is the object from which this array was generated (for example, when slicing or view()ing)</span>
        
        <span class="c1">## We use the getattr method to set a default if &#39;obj&#39; doesn&#39;t have the &#39;info&#39; attribute</span>
        <span class="c1">##print &quot;Create new MA from object&quot;, str(type(obj))</span>
        <span class="c1">##import traceback</span>
        <span class="c1">##traceback.print_stack()</span>
        <span class="c1">##print &quot;finalize&quot;, type(self), type(obj)</span>
        <span class="c1">#if not hasattr(self, &#39;_info&#39;):</span>
            <span class="c1">##if isinstance(obj, MetaArray):</span>
                <span class="c1">##print &quot;  copy info:&quot;, obj._info</span>
            <span class="c1">#self._info = getattr(obj, &#39;_info&#39;, [{}]*(obj.ndim+1))</span>
            <span class="c1">#self._infoOwned = False  ## Do not make changes to _info until it is copied at least once</span>
        <span class="c1">##print &quot;  self info:&quot;, self._info</span>
      
        <span class="c1">## We could have checked first whether self._info was already defined:</span>
        <span class="c1">##if not hasattr(self, &#39;info&#39;):</span>
        <span class="c1">##    self._info = getattr(obj, &#39;info&#39;, {})</span>
    
  
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="c1">#print &quot;getitem:&quot;, ind</span>
        
        <span class="c1">## should catch scalar requests as early as possible to speed things up (?)</span>
        
        <span class="n">nInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretIndexes</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        
        <span class="c1">#a = np.ndarray.__getitem__(self, nInd)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">nInd</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nInd</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">slice</span><span class="p">)</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">nInd</span><span class="p">]):</span>  <span class="c1">## no slices; we have requested a single value from the array</span>
                <span class="k">return</span> <span class="n">a</span>
        <span class="c1">#if type(a) != type(self._data) and not isinstance(a, np.ndarray):  ## indexing returned single value</span>
            <span class="c1">#return a</span>
        
        <span class="c1">## indexing returned a sub-array; generate new info array to go with it</span>
        <span class="c1">#print &quot;   new MA:&quot;, type(a), a.shape</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extraInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nInd</span><span class="p">)):</span>   <span class="c1">## iterate over all axes</span>
            <span class="c1">#print &quot;   axis&quot;, i</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nInd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nInd</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>  <span class="c1">## If the axis is sliced, keep the info but chop if necessary</span>
                <span class="c1">#print &quot;      slice axis&quot;, i, nInd[i]</span>
                <span class="c1">#a._info[i] = self._axisSlice(i, nInd[i])</span>
                <span class="c1">#print &quot;         info:&quot;, a._info[i]</span>
                <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisSlice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nInd</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">## If the axis is indexed, then move the information from that single index to the last info dictionary</span>
                <span class="c1">#print &quot;indexed:&quot;, i, nInd[i], type(nInd[i])</span>
                <span class="n">newInfo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axisSlice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nInd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">colName</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">newInfo</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;cols&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extraInfo</span><span class="p">:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                            <span class="n">colName</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extraInfo</span><span class="p">:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">extraInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extraInfo</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">colName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colName</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">colName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">colName</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">extraInfo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
                        
                        
                <span class="c1">#print &quot;Lost info:&quot;, newInfo</span>
                <span class="c1">#a._info[i] = None</span>
                <span class="c1">#if &#39;name&#39; in newInfo:</span>
                    <span class="c1">#a._info[-1][newInfo[&#39;name&#39;]] = newInfo</span>
        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extraInfo</span><span class="p">)</span>
        
        <span class="c1">#self._infoOwned = False</span>
        <span class="c1">#while None in a._info:</span>
            <span class="c1">#a._info.remove(None)</span>
        <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
  
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1">## hdf5 objects do not have ndim property.</span>
            
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">dtype</span>
        
    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>
  
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">nInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretIndexes</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">nInd</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nInd</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">raise</span>
        
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapMethods</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="c1">#return lambda *args, **kwargs: MetaArray(getattr(a.view(ndarray), attr)(*args, **kwargs)</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__eq__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__ne__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1">#if isinstance(b, MetaArray):</span>
            <span class="c1">#b = b.asarray()</span>
        <span class="c1">#return self.asarray() != b</span>
        
    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__sub__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1">#if isinstance(b, MetaArray):</span>
            <span class="c1">#b = b.asarray()</span>
        <span class="c1">#return MetaArray(self.asarray() - b, info=self.infoCopy())</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__add__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__mul__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__div__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binop</span><span class="p">(</span><span class="s1">&#39;__truediv__&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_binop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">MetaArray</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">op</span><span class="p">)(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Binary operators with MetaArray must return an array of the same shape (this shape is </span><span class="si">%s</span><span class="s2">, result shape was </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infoCopy</span><span class="p">())</span>
        
<div class="viewcode-block" id="MetaArray.asarray"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.asarray">[docs]</a>    <span class="k">def</span> <span class="nf">asarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span></div>
            
    <span class="k">def</span> <span class="nf">__array__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## supports np.array(metaarray_instance) </span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
            
<div class="viewcode-block" id="MetaArray.view"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span>
        <span class="c1">## deprecated; kept for backward compatibility</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;invalid view type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">typ</span><span class="p">))</span></div>
  
<div class="viewcode-block" id="MetaArray.axisValues"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisValues">[docs]</a>    <span class="k">def</span> <span class="nf">axisValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of values for an axis&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">ax</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">ax</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Array axis </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%d</span><span class="s1">) has no associated values.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">ax</span><span class="p">))</span></div>
  
<div class="viewcode-block" id="MetaArray.xvals"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.xvals">[docs]</a>    <span class="k">def</span> <span class="nf">xvals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Synonym for axisValues()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisValues</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="MetaArray.axisHasValues"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisHasValues">[docs]</a>    <span class="k">def</span> <span class="nf">axisHasValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="MetaArray.axisHasColumns"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisHasColumns">[docs]</a>    <span class="k">def</span> <span class="nf">axisHasColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span></div>
  
<div class="viewcode-block" id="MetaArray.axisUnits"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisUnits">[docs]</a>    <span class="k">def</span> <span class="nf">axisUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the units for axis&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="MetaArray.hasColumn"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.hasColumn">[docs]</a>    <span class="k">def</span> <span class="nf">hasColumn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">col</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
        
<div class="viewcode-block" id="MetaArray.listColumns"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.listColumns">[docs]</a>    <span class="k">def</span> <span class="nf">listColumns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of column names for axis. If axis is not specified, then return a dict of {axisName: (column names), ...}.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ret</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axisName</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">axis</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">]]</span></div>
        
<div class="viewcode-block" id="MetaArray.columnName"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.columnName">[docs]</a>    <span class="k">def</span> <span class="nf">columnName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="MetaArray.axisName"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisName">[docs]</a>    <span class="k">def</span> <span class="nf">axisName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="MetaArray.columnUnits"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.columnUnits">[docs]</a>    <span class="k">def</span> <span class="nf">columnUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the units for column in axis&quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)]</span>
        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">column</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Axis </span><span class="si">%s</span><span class="s2"> has no column named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">column</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Axis </span><span class="si">%s</span><span class="s2"> has no column definitions&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span></div>
  
<div class="viewcode-block" id="MetaArray.rowsort"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.rowsort">[docs]</a>    <span class="k">def</span> <span class="nf">rowsort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return this object with all records sorted along axis using key as the index to the values to compare. Does not yet modify meta info.&quot;&quot;&quot;</span>
        <span class="c1">## make sure _info is copied locally before modifying it!</span>
    
        <span class="n">keyList</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">keyList</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span><span class="o">*</span><span class="n">axis</span>
            <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">order</span><span class="p">),)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span></div>
  
<div class="viewcode-block" id="MetaArray.append"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return this object with val appended along axis. Does not yet combine meta info.&quot;&quot;&quot;</span>
        <span class="c1">## make sure _info is copied locally before modifying it!</span>
    
        <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">s</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">ind</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">ind</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">n</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">n</span></div>
  
<div class="viewcode-block" id="MetaArray.extend"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the concatenation along axis of this object and val. Does not yet combine meta info.&quot;&quot;&quot;</span>
        <span class="c1">## make sure _info is copied locally before modifying it!</span>
    
        <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span></div>
  
<div class="viewcode-block" id="MetaArray.infoCopy"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.infoCopy">[docs]</a>    <span class="k">def</span> <span class="nf">infoCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a deep copy of the axis meta info for this object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)])</span></div>
  
<div class="viewcode-block" id="MetaArray.copy"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infoCopy</span><span class="p">())</span></div>
  
  
    <span class="k">def</span> <span class="nf">_interpretIndexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="c1">#print &quot;interpret&quot;, ind</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1">## a list of slices should be interpreted as a tuple of slices.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="c1">## everything else can just be converted to a length-1 tuple</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">ind</span><span class="p">,)</span>
                
        <span class="n">nInd</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">numOk</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1">## Named indices not started yet; numbered sill ok</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
            <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">isNamed</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretIndex</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">numOk</span><span class="p">)</span>
            <span class="c1">#try:</span>
            <span class="n">nInd</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
            <span class="c1">#except:</span>
                <span class="c1">#print &quot;ndim:&quot;, self.ndim</span>
                <span class="c1">#print &quot;axis:&quot;, axis</span>
                <span class="c1">#print &quot;index spec:&quot;, ind[i]</span>
                <span class="c1">#print &quot;index num:&quot;, index</span>
                <span class="c1">#raise</span>
            <span class="k">if</span> <span class="n">isNamed</span><span class="p">:</span>
                <span class="n">numOk</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nInd</span><span class="p">)</span>
      
    <span class="k">def</span> <span class="nf">_interpretAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">basestring</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">axis</span>
  
    <span class="k">def</span> <span class="nf">_interpretIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">numOk</span><span class="p">):</span>
        <span class="c1">#print &quot;Interpreting index&quot;, ind, pos, numOk</span>
        
        <span class="c1">## should probably check for int first to speed things up..</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numOk</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;string and integer indexes may not follow named indexes&quot;</span><span class="p">)</span>
            <span class="c1">#print &quot;  normal numerical index&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numOk</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;string and integer indexes may not follow named indexes&quot;</span><span class="p">)</span>
            <span class="c1">#print &quot;  String index, column is &quot;, self._getIndex(pos, ind)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIndex</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ind</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
            <span class="c1">#print &quot;  Slice index&quot;</span>
            <span class="k">if</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="ow">or</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">):</span>  <span class="c1">## Not an actual slice!</span>
                <span class="c1">#print &quot;    ..not a real slice&quot;</span>
                <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
                <span class="c1">#print &quot;    axis is&quot;, axis</span>
                
                <span class="c1">## x[Axis:Column]</span>
                <span class="k">if</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">):</span>
                    <span class="c1">#print &quot;    column name, column is &quot;, self._getIndex(axis, ind.stop)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIndex</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span>
                    
                <span class="c1">## x[Axis:min:max]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">axis</span><span class="p">]):</span>
                    <span class="c1">#print &quot;    axis value range&quot;</span>
                    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xvals</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ind</span><span class="o">.</span><span class="n">step</span>
                    <span class="k">elif</span> <span class="n">ind</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xvals</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xvals</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xvals</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ind</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
                    <span class="c1">##print &quot;mask:&quot;, mask</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">mask</span>
                    
                <span class="c1">## x[Axis:columnIndex]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="c1">#print &quot;    normal slice after named axis&quot;</span>
                    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">ind</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
                    
                <span class="c1">## x[Axis: [list]]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="c1">#print &quot;    list of indexes from named axis&quot;</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                            <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getIndex</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1">## unrecognized type, try just passing on to array</span>
                            <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span>
                            <span class="k">break</span>
                
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#print &quot;    other type.. forward on to array for handling&quot;, type(ind.stop)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">ind</span><span class="o">.</span><span class="n">stop</span>
                <span class="c1">#print &quot;Axis %s (%s) : %s&quot; % (ind.start, str(axis), str(type(index)))</span>
                <span class="c1">#if type(index) is np.ndarray:</span>
                    <span class="c1">#print &quot;    &quot;, index.shape</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#print &quot;  Looks like a real slice, passing on to array&quot;</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1">#print &quot;  List index., interpreting each element individually&quot;</span>
            <span class="n">indList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretIndex</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">numOk</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">indList</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numOk</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;string and integer indexes may not follow named indexes&quot;</span><span class="p">)</span>
            <span class="c1">#print &quot;  normal numerical index&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
  
    <span class="k">def</span> <span class="nf">_getAxis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)):</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">axis</span> <span class="ow">and</span> <span class="n">axis</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No axis named </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">  info=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">))</span>
  
    <span class="k">def</span> <span class="nf">_getIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">])):</span>
                <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Axis </span><span class="si">%d</span><span class="s2"> has no column named </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">  info=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">))</span>
  
    <span class="k">def</span> <span class="nf">_axisCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
  
    <span class="k">def</span> <span class="nf">_axisSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="c1">#print &quot;axisSlice&quot;, i, cols</span>
        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axisCopy</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="c1">#print &quot;  slicing columns..&quot;, array(ax[&#39;cols&#39;]), cols</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">])[</span><span class="n">cols</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">sl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sl</span>
                <span class="c1">#print &quot;  result:&quot;, ax[&#39;cols&#39;]</span>
            <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">])[</span><span class="n">cols</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1">#print &quot;     &quot;, ax</span>
        <span class="k">return</span> <span class="n">ax</span>
  
<div class="viewcode-block" id="MetaArray.prettyInfo"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.prettyInfo">[docs]</a>    <span class="k">def</span> <span class="nf">prettyInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">maxl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span>
            <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">])</span>
            <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxl</span><span class="p">:</span>
                <span class="n">maxl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">axs</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">[</span><span class="si">%d</span><span class="s1">] :&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxl</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">v0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s2">&quot; values: [</span><span class="si">%g</span><span class="s2"> ... </span><span class="si">%g</span><span class="s2">] (step </span><span class="si">%g</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="o">-</span><span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s2">&quot; columns: &quot;</span>
                <span class="n">colstrs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">])):</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s1">&#39;units&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                        <span class="n">cs</span> <span class="o">+=</span> <span class="s2">&quot; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span>
                    <span class="n">colstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
                <span class="n">axs</span> <span class="o">+=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">colstrs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">axs</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span></div>
  
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">-----------------------------------------------</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">prettyInfo</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>


<div class="viewcode-block" id="MetaArray.axisCollapsingFn"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.axisCollapsingFn">[docs]</a>    <span class="k">def</span> <span class="nf">axisCollapsingFn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="c1">#arr = self.view(np.ndarray)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoCopy</span><span class="p">()</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">info</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">fn</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaArray.mean"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisCollapsingFn</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>
            

<div class="viewcode-block" id="MetaArray.min"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisCollapsingFn</span><span class="p">(</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaArray.max"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisCollapsingFn</span><span class="p">(</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaArray.transpose"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.transpose">[docs]</a>    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="n">order</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
        <span class="n">infoOrder</span> <span class="o">=</span> <span class="n">order</span>  <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infoOrder</span><span class="p">]</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">order</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isHDF</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">MetaArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
            <span class="k">raise</span></div>

    <span class="c1">#### File I/O Routines</span>
<div class="viewcode-block" id="MetaArray.readFile"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.readFile">[docs]</a>    <span class="k">def</span> <span class="nf">readFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the data and meta info stored in *filename*</span>
<span class="sd">        Different arguments are allowed depending on the type of file.</span>
<span class="sd">        For HDF5 files:</span>
<span class="sd">        </span>
<span class="sd">            *writable* (bool) if True, then any modifications to data in the array will be stored to disk.</span>
<span class="sd">            *readAllData* (bool) if True, then all data in the array is immediately read from disk</span>
<span class="sd">                          and the file is closed (this is the default for files &lt; 500MB). Otherwise, the file will</span>
<span class="sd">                          be left open and data will be read only as requested (this is </span>
<span class="sd">                          the default for files &gt;= 500MB).</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## decide which read function to use</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">magic</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">magic</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\x89</span><span class="s1">HDF</span><span class="se">\r\n\x1a\n</span><span class="s1">&#39;</span><span class="p">:</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_readHDF5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isHDF</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">_readMeta</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;readAllData&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;version&#39;</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">:</span>
                    <span class="n">ver</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ver</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">rFuncName</span> <span class="o">=</span> <span class="s1">&#39;_readData</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">MetaArray</span><span class="p">,</span> <span class="n">rFuncName</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This MetaArray library does not support array version &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">)</span>
                <span class="n">rFunc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rFuncName</span><span class="p">)</span>
                <span class="n">rFunc</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isHDF</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_readMeta</span><span class="p">(</span><span class="n">fd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read meta array from the top of a file. Read lines until a blank line is reached.</span>
<span class="sd">        This function should ideally work for ALL versions of MetaArray.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1">## Read meta information until the first blank line</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">meta</span> <span class="o">+=</span> <span class="n">line</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
        <span class="c1">#print ret</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_readData1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1">## Read array data from the file descriptor for MetaArray v1 files</span>
        <span class="c1">## read in axis values for any axis that specifies a length</span>
        <span class="n">frameSize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;values_len&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">])</span>
                <span class="n">frameSize</span> <span class="o">*=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;readAllData&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c1">## the remaining data is the actual array</span>
        <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
            <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="n">subarr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">subarr</span>
            
    <span class="k">def</span> <span class="nf">_readData2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1">## read in axis values</span>
        <span class="n">dynAxis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">frameSize</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">## read in axis values for any axis that specifies a length</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">])):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;values_len&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dynAxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;MetaArray has more than one dynamic axis! (this is not allowed)&quot;</span><span class="p">)</span>
                    <span class="n">dynAxis</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">])</span>
                    <span class="n">frameSize</span> <span class="o">*=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;readAllData&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1">## No axes are dynamic, just read the entire array in at once</span>
        <span class="k">if</span> <span class="n">dynAxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#if rewriteDynamic is not None:</span>
                <span class="c1">#raise Exception(&quot;&quot;)</span>
            <span class="k">if</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;memmap not supported for arrays with dtype=object&#39;</span><span class="p">)</span>
                <span class="n">subarr</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                    <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="c1">#subarr = subarr.view(subtype)</span>
            <span class="n">subarr</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
            <span class="c1">#subarr._info = meta[&#39;info&#39;]</span>
        <span class="c1">## One axis is dynamic, read in a frame at a time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;memmap not supported for non-contiguous arrays. Use rewriteContiguous() to convert.&#39;</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="n">dynAxis</span><span class="p">]</span>
            <span class="n">xVals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">frameShape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span>
            <span class="n">frameShape</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">frameSize</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">frameShape</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1">## Extract one non-blank line</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">break</span>
                    
                <span class="c1">## evaluate line</span>
                <span class="n">inf</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                
                <span class="c1">## read data block</span>
                <span class="c1">#print &quot;read %d bytes as %s&quot; % (inf[&#39;len&#39;], meta[&#39;type&#39;])</span>
                <span class="k">if</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">inf</span><span class="p">[</span><span class="s1">&#39;len&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">inf</span><span class="p">[</span><span class="s1">&#39;len&#39;</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">frameSize</span> <span class="o">*</span> <span class="n">inf</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]:</span>
                    <span class="c1">#print data.size, frameSize, inf[&#39;numFrames&#39;]</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Wrong frame size in MetaArray file! (frame </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
                    
                <span class="c1">## read in data block</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">frameShape</span><span class="p">)</span>
                <span class="n">shape</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">inf</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
                <span class="k">if</span> <span class="n">subset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dSlice</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dSlice</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dStart</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dStart</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dSlice</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dSlice</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dStop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dStop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">],</span> <span class="n">dSlice</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
                    <span class="n">newSubset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">subset</span><span class="p">[:])</span>
                    <span class="n">newSubset</span><span class="p">[</span><span class="n">dynAxis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">dStart</span><span class="p">,</span> <span class="n">dStop</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dStop</span> <span class="o">&gt;</span> <span class="n">dStart</span><span class="p">:</span>
                        <span class="c1">#print n, data.shape, &quot; =&gt; &quot;, newSubset, data[tuple(newSubset)].shape</span>
                        <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">newSubset</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#data = data[subset].copy()  ## what&#39;s this for??</span>
                    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                
                <span class="n">n</span> <span class="o">+=</span> <span class="n">inf</span><span class="p">[</span><span class="s1">&#39;numFrames&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;xVals&#39;</span> <span class="ow">in</span> <span class="n">inf</span><span class="p">:</span>
                    <span class="n">xVals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inf</span><span class="p">[</span><span class="s1">&#39;xVals&#39;</span><span class="p">])</span>
            <span class="n">subarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">dynAxis</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xVals</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xVals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">])</span>
            <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">]</span>
        <span class="c1">#subarr = subarr.view(subtype)</span>
        <span class="c1">#subarr._info = meta[&#39;info&#39;]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">subarr</span>
        <span class="c1">#raise Exception()  ## stress-testing</span>
        <span class="c1">#return subarr</span>

    <span class="k">def</span> <span class="nf">_readHDF5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">readAllData</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">writable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;close&#39;</span> <span class="ow">in</span> <span class="n">kargs</span> <span class="ow">and</span> <span class="n">readAllData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">## for backward compatibility</span>
            <span class="n">readAllData</span> <span class="o">=</span> <span class="n">kargs</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span>
       
        <span class="k">if</span> <span class="n">readAllData</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">writable</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Incompatible arguments: readAllData=True and writable=True&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">HAVE_HDF5</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">writable</span><span class="o">==</span><span class="kc">False</span>
                <span class="k">assert</span> <span class="n">readAllData</span> <span class="o">!=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_readHDF5Remote</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file &#39;</span><span class="si">%s</span><span class="s2">&#39; is HDF5-formatted, but the HDF5 library (h5py) was not found.&quot;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>
        
        <span class="c1">## by default, readAllData=True for files &lt; 500MB</span>
        <span class="k">if</span> <span class="n">readAllData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
            <span class="n">readAllData</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mf">500e6</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">writable</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r+&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        
        <span class="n">ver</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ver</span> <span class="o">&gt;</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: This file was written with MetaArray version </span><span class="si">%s</span><span class="s2">, but you are using version </span><span class="si">%s</span><span class="s2">. (Will attempt to read anyway)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span><span class="p">)))</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">readHDF5Meta</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">meta</span>
        
        <span class="k">if</span> <span class="n">writable</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">readAllData</span><span class="p">:</span>  <span class="c1">## read all data, convert to ndarray, close file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_openFile</span> <span class="o">=</span> <span class="n">f</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][:]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">_readHDF5Remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="c1">## Used to read HDF5 files via remote process.</span>
        <span class="c1">## This is needed in the case that HDF5 is not importable due to the use of python-dbg.</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MetaArray</span><span class="p">,</span> <span class="s1">&#39;_hdf5Process&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">proc</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;remote read failed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">proc</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">multiprocess</span> <span class="k">as</span> <span class="n">mp</span>
            <span class="c1">#print &quot;new process&quot;</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">executable</span><span class="o">=</span><span class="s1">&#39;/usr/bin/python&#39;</span><span class="p">)</span>
            <span class="n">proc</span><span class="o">.</span><span class="n">setProxyOptions</span><span class="p">(</span><span class="n">deferGetattr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">MetaArray</span><span class="o">.</span><span class="n">_hdf5Process</span> <span class="o">=</span> <span class="n">proc</span>
            <span class="n">MetaArray</span><span class="o">.</span><span class="n">_h5py_metaarray</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">_import</span><span class="p">(</span><span class="s1">&#39;pyqtgraph.metaarray&#39;</span><span class="p">)</span>
        <span class="n">ma</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">_h5py_metaarray</span><span class="o">.</span><span class="n">MetaArray</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">fileName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span><span class="o">.</span><span class="n">_getValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">_info</span><span class="o">.</span><span class="n">_getValue</span><span class="p">()</span>
        <span class="c1">#print MetaArray._hdf5Process</span>
        <span class="c1">#import inspect</span>
        <span class="c1">#print MetaArray, id(MetaArray), inspect.getmodule(MetaArray)</span>
        
        

<div class="viewcode-block" id="MetaArray.mapHDF5Array"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.mapHDF5Array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">mapHDF5Array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">writable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">off</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">get_offset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">writable</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r+&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="k">if</span> <span class="n">off</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This dataset uses chunked storage; it can not be memory-mapped. (store using mappable=True)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">off</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>
        



<div class="viewcode-block" id="MetaArray.readHDF5Meta"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.readHDF5Meta">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">readHDF5Meta</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">## Pull list of values from attributes and child objects</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>  <span class="c1">## strings need to be re-evaluated to their original types</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Can not evaluate string: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">highlevel</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">readHDF5Meta</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">highlevel</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">mmap</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">mapHDF5Array</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Don&#39;t know what to do with type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)))</span>
            <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        
        <span class="n">typ</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_metaType_&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;_metaType_&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;dict&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span> <span class="ow">or</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;tuple&#39;</span><span class="p">:</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">d2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;tuple&#39;</span><span class="p">:</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">d2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Don&#39;t understand metaType &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="MetaArray.write"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write this object to a file. The object can be restored by calling MetaArray(file=fileName)</span>
<span class="sd">        opts:</span>
<span class="sd">            appendAxis: the name (or index) of the appendable axis. Allows the array to grow.</span>
<span class="sd">            compression: None, &#39;gzip&#39; (good compression), &#39;lzf&#39; (fast compression), etc.</span>
<span class="sd">            chunks: bool or tuple specifying chunk shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">USE_HDF5</span> <span class="ow">and</span> <span class="n">HAVE_HDF5</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeHDF5</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeMa</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaArray.writeMeta"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.writeMeta">[docs]</a>    <span class="k">def</span> <span class="nf">writeMeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to re-write meta info to the given file.</span>
<span class="sd">        This feature is only available for HDF5 files.&quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> was created with a different version of MetaArray. Will not modify.&quot;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">writeHDF5Meta</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="MetaArray.writeHDF5"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.writeHDF5">[docs]</a>    <span class="k">def</span> <span class="nf">writeHDF5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">opts</span><span class="p">):</span>
        <span class="c1">## default options for writing datasets</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultCompression</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">comp</span><span class="p">,</span> <span class="n">copts</span> <span class="o">=</span> <span class="n">comp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copts</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">dsOpts</span> <span class="o">=</span> <span class="p">{</span>  
            <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
            <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">copts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;compression_opts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copts</span>
        
        <span class="c1">## if there is an appendable axis, then we can guess the desired chunk shape (optimized for appending)</span>
        <span class="n">appAxis</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;appendAxis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">appAxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">appAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">appAxis</span><span class="p">)</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
            <span class="n">cs</span><span class="p">[</span><span class="n">appAxis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
            
        <span class="c1">## if there are columns, then we can guess a different chunk shape</span>
        <span class="c1">## (read one column at a time)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
        
        <span class="c1">## update options if they were passed in</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dsOpts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
                <span class="n">dsOpts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        
        <span class="c1">## If mappable is in options, it disables chunking/compression</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mappable&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">dsOpts</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;chunks&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;compression&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>
        
            
        <span class="c1">## set maximum shape to allow expansion along appendAxis</span>
        <span class="n">append</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">appAxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxShape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">appAxis</span><span class="p">)</span>
            <span class="n">maxShape</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
                <span class="n">append</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;maxshape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">maxShape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;maxshape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> was created with a different version of MetaArray. Will not modify.&quot;</span> <span class="o">%</span> <span class="n">fileName</span><span class="p">)</span>
            
            <span class="c1">## resize data and write in new values</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">sl</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            
            <span class="c1">## add axis values if they are present.</span>
            <span class="n">axInfo</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">)]</span>
            <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">axInfo</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">axInfo</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="n">ax</span><span class="p">][</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">v</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="n">v2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span> <span class="o">=</span> <span class="n">v2</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;MetaArray&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span>
            <span class="c1">#print dsOpts</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">)</span>
            
            <span class="c1">## dsOpts is used when storing meta data whenever an array is encountered</span>
            <span class="c1">## however, &#39;chunks&#39; will no longer be valid for these arrays if it specifies a chunk shape.</span>
            <span class="c1">## &#39;maxshape&#39; is right-out.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="s1">&#39;maxshape&#39;</span> <span class="ow">in</span> <span class="n">dsOpts</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;maxshape&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeHDF5Meta</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">,</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="MetaArray.writeHDF5Meta"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.writeHDF5Meta">[docs]</a>    <span class="k">def</span> <span class="nf">writeHDF5Meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">dsOpts</span><span class="p">[</span><span class="s1">&#39;maxshape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">root</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">gr</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_metaType_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;list&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_metaType_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tuple&#39;</span>
            <span class="c1">#n = int(np.log10(len(data))) + 1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writeHDF5Meta</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">gr</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">gr</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;_metaType_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dict&#39;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">writeHDF5Meta</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">dsOpts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
            <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>   <span class="c1">## strings, bools, None are stored as repr() strings</span>
                <span class="n">root</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can not store meta data of type &#39;</span><span class="si">%s</span><span class="s2">&#39; in HDF5. (key is &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
                <span class="k">raise</span> </div>

        
<div class="viewcode-block" id="MetaArray.writeMa"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.writeMa">[docs]</a>    <span class="k">def</span> <span class="nf">writeMa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">appendAxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newFile</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write an old-style .ma file&quot;&quot;&quot;</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shape&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="s1">&#39;info&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">infoCopy</span><span class="p">(),</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span><span class="n">MetaArray</span><span class="o">.</span><span class="n">version</span><span class="p">}</span>
        <span class="n">axstrs</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1">## copy out axis values for dynamic axis if requested</span>
        <span class="k">if</span> <span class="n">appendAxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">MetaArray</span><span class="o">.</span><span class="n">isNameType</span><span class="p">(</span><span class="n">appendAxis</span><span class="p">):</span>
                <span class="n">appendAxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpretAxis</span><span class="p">(</span><span class="n">appendAxis</span><span class="p">)</span>
            
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="n">appendAxis</span><span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">dynXVals</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dynXVals</span> <span class="o">=</span> <span class="kc">None</span>
                
        <span class="c1">## Generate axis data string, modify axis info so we know how to read it back in later</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;values&#39;</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">axstrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_len&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axstrs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">ax</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                
        <span class="c1">## Decide whether to output the meta block for a new file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newFile</span><span class="p">:</span>
            <span class="c1">## If the file does not exist or its size is 0, then we must write the header</span>
            <span class="n">newFile</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>  <span class="ow">or</span>  <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">## write data to file</span>
        <span class="k">if</span> <span class="n">appendAxis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">newFile</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axstrs</span><span class="p">:</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">object</span><span class="p">:</span>
            <span class="n">dataStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataStr</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
        <span class="c1">#print self.size, len(dataStr), self.dtype</span>
        <span class="k">if</span> <span class="n">appendAxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">frameInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;len&#39;</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">dataStr</span><span class="p">),</span> <span class="s1">&#39;numFrames&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">appendAxis</span><span class="p">]}</span>
            <span class="k">if</span> <span class="n">dynXVals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">frameInfo</span><span class="p">[</span><span class="s1">&#39;xVals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dynXVals</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">frameInfo</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataStr</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="MetaArray.writeCsv"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.html#bornagain.external.pyqtgraph.pyqtgraph.metaarray.MetaArray.MetaArray.writeCsv">[docs]</a>    <span class="k">def</span> <span class="nf">writeCsv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write 2D array to CSV file or return the string if no filename is given&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CSV Export is only for 2D arrays&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cols&#39;</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[:,</span> <span class="n">row</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="k">if</span> <span class="n">fileName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span></div></div>
        


<span class="c1">#class H5MetaList():</span>
    

<span class="c1">#def rewriteContiguous(fileName, newName):</span>
    <span class="c1">#&quot;&quot;&quot;Rewrite a dynamic array file as contiguous&quot;&quot;&quot;</span>
    <span class="c1">#def _readData2(fd, meta, subtype, mmap):</span>
        <span class="c1">### read in axis values</span>
        <span class="c1">#dynAxis = None</span>
        <span class="c1">#frameSize = 1</span>
        <span class="c1">### read in axis values for any axis that specifies a length</span>
        <span class="c1">#for i in range(len(meta[&#39;info&#39;])):</span>
            <span class="c1">#ax = meta[&#39;info&#39;][i]</span>
            <span class="c1">#if ax.has_key(&#39;values_len&#39;):</span>
                <span class="c1">#if ax[&#39;values_len&#39;] == &#39;dynamic&#39;:</span>
                    <span class="c1">#if dynAxis is not None:</span>
                        <span class="c1">#raise Exception(&quot;MetaArray has more than one dynamic axis! (this is not allowed)&quot;)</span>
                    <span class="c1">#dynAxis = i</span>
                <span class="c1">#else:</span>
                    <span class="c1">#ax[&#39;values&#39;] = fromstring(fd.read(ax[&#39;values_len&#39;]), dtype=ax[&#39;values_type&#39;])</span>
                    <span class="c1">#frameSize *= ax[&#39;values_len&#39;]</span>
                    <span class="c1">#del ax[&#39;values_len&#39;]</span>
                    <span class="c1">#del ax[&#39;values_type&#39;]</span>
                    
        <span class="c1">### No axes are dynamic, just read the entire array in at once</span>
        <span class="c1">#if dynAxis is None:</span>
            <span class="c1">#raise Exception(&#39;Array has no dynamic axes.&#39;)</span>
        <span class="c1">### One axis is dynamic, read in a frame at a time</span>
        <span class="c1">#else:</span>
            <span class="c1">#if mmap:</span>
                <span class="c1">#raise Exception(&#39;memmap not supported for non-contiguous arrays. Use rewriteContiguous() to convert.&#39;)</span>
            <span class="c1">#ax = meta[&#39;info&#39;][dynAxis]</span>
            <span class="c1">#xVals = []</span>
            <span class="c1">#frames = []</span>
            <span class="c1">#frameShape = list(meta[&#39;shape&#39;])</span>
            <span class="c1">#frameShape[dynAxis] = 1</span>
            <span class="c1">#frameSize = reduce(lambda a,b: a*b, frameShape)</span>
            <span class="c1">#n = 0</span>
            <span class="c1">#while True:</span>
                <span class="c1">### Extract one non-blank line</span>
                <span class="c1">#while True:</span>
                    <span class="c1">#line = fd.readline()</span>
                    <span class="c1">#if line != &#39;\n&#39;:</span>
                        <span class="c1">#break</span>
                <span class="c1">#if line == &#39;&#39;:</span>
                    <span class="c1">#break</span>
                    
                <span class="c1">### evaluate line</span>
                <span class="c1">#inf = eval(line)</span>
                
                <span class="c1">### read data block</span>
                <span class="c1">##print &quot;read %d bytes as %s&quot; % (inf[&#39;len&#39;], meta[&#39;type&#39;])</span>
                <span class="c1">#if meta[&#39;type&#39;] == &#39;object&#39;:</span>
                    <span class="c1">#data = pickle.loads(fd.read(inf[&#39;len&#39;]))</span>
                <span class="c1">#else:</span>
                    <span class="c1">#data = fromstring(fd.read(inf[&#39;len&#39;]), dtype=meta[&#39;type&#39;])</span>
                
                <span class="c1">#if data.size != frameSize * inf[&#39;numFrames&#39;]:</span>
                    <span class="c1">##print data.size, frameSize, inf[&#39;numFrames&#39;]</span>
                    <span class="c1">#raise Exception(&quot;Wrong frame size in MetaArray file! (frame %d)&quot; % n)</span>
                    
                <span class="c1">### read in data block</span>
                <span class="c1">#shape = list(frameShape)</span>
                <span class="c1">#shape[dynAxis] = inf[&#39;numFrames&#39;]</span>
                <span class="c1">#data.shape = shape</span>
                <span class="c1">#frames.append(data)</span>
                
                <span class="c1">#n += inf[&#39;numFrames&#39;]</span>
                <span class="c1">#if &#39;xVals&#39; in inf:</span>
                    <span class="c1">#xVals.extend(inf[&#39;xVals&#39;])</span>
            <span class="c1">#subarr = np.concatenate(frames, axis=dynAxis)</span>
            <span class="c1">#if len(xVals)&gt; 0:</span>
                <span class="c1">#ax[&#39;values&#39;] = array(xVals, dtype=ax[&#39;values_type&#39;])</span>
            <span class="c1">#del ax[&#39;values_len&#39;]</span>
            <span class="c1">#del ax[&#39;values_type&#39;]</span>
        <span class="c1">#subarr = subarr.view(subtype)</span>
        <span class="c1">#subarr._info = meta[&#39;info&#39;]</span>
        <span class="c1">#return subarr</span>
    


  
  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1">## Create an array with every option possible</span>
    
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                    <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">axis</span><span class="p">(</span><span class="s1">&#39;Axis1&#39;</span><span class="p">),</span> 
        <span class="n">axis</span><span class="p">(</span><span class="s1">&#39;Axis2&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span> 
        <span class="n">axis</span><span class="p">(</span><span class="s1">&#39;Axis3&#39;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;Ax3Col1&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Ax3Col2&#39;</span><span class="p">,</span> <span class="s1">&#39;mV&#39;</span><span class="p">,</span> <span class="s1">&#39;Axis3 Column2&#39;</span><span class="p">),</span>
            <span class="p">((</span><span class="s1">&#39;Ax3&#39;</span><span class="p">,</span><span class="s1">&#39;Col3&#39;</span><span class="p">),</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Axis3 Column3&#39;</span><span class="p">)]),</span>
        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Axis4&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;extra&#39;</span><span class="p">:</span> <span class="s1">&#39;info&#39;</span><span class="p">}</span>
    <span class="p">]</span>
    
    <span class="n">ma</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;====  Original Array =======&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1">#### Tests follow:</span>
    
    
    <span class="c1">#### Index/slice tests: check that all values and meta info are correct after slice</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- normal integer indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[1]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[1, 2:4]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[1, 1:5:2]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- named axis indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis2&#39;:3]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis2&#39;:3:5]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[1, &#39;Axis2&#39;:3]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[:, &#39;Axis2&#39;:3]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[:,</span> <span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis2&#39;:3, &#39;Axis4&#39;:0:2]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Axis4&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- column name indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis3&#39;:&#39;Ax3Col1&#39;]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis3&#39;</span><span class="p">:</span><span class="s1">&#39;Ax3Col1&#39;</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis3&#39;:(&#39;Ax3&#39;,&#39;Col3&#39;)]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis3&#39;</span><span class="p">:(</span><span class="s1">&#39;Ax3&#39;</span><span class="p">,</span><span class="s1">&#39;Col3&#39;</span><span class="p">)])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[:, :, &#39;Ax3Col2&#39;]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[:,</span> <span class="p">:,</span> <span class="s1">&#39;Ax3Col2&#39;</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[:, :, (&#39;Ax3&#39;,&#39;Col3&#39;)]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">(</span><span class="s1">&#39;Ax3&#39;</span><span class="p">,</span><span class="s1">&#39;Col3&#39;</span><span class="p">)])</span>
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- axis value range indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis2&#39;:1.5:4.5]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">:</span><span class="mf">4.5</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis4&#39;:1.15:1.45]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis4&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">:</span><span class="mf">1.45</span><span class="p">])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis4&#39;:1.15:1.25]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis4&#39;</span><span class="p">:</span><span class="mf">1.15</span><span class="p">:</span><span class="mf">1.25</span><span class="p">])</span>
    
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- list indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[:, [0,2,4]]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis4&#39;:[0,2,4]]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis4&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis3&#39;:[0, (&#39;Ax3&#39;,&#39;Col3&#39;)]]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis3&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;Ax3&#39;</span><span class="p">,</span><span class="s1">&#39;Col3&#39;</span><span class="p">)]])</span>
    
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- boolean indexing</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[:, array([True, True, False, True, False])]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])])</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  ma[&#39;Axis4&#39;:array([True, False, False, False])]&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis4&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">])])</span>
    
    
    
    
    
    <span class="c1">#### Array operations </span>
    <span class="c1">#  - Concatenate</span>
    <span class="c1">#  - Append</span>
    <span class="c1">#  - Extend</span>
    <span class="c1">#  - Rowsort</span>
    
    
    
    
    <span class="c1">#### File I/O tests</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">================  File I/O Tests  ===================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">tempfile</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">()</span>
    <span class="n">tf</span> <span class="o">=</span> <span class="s1">&#39;test.ma&#39;</span>
    <span class="c1"># write whole array</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  -- write/read test&quot;</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
    <span class="n">ma2</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span>
    
    <span class="c1">#print ma2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Arrays are equivalent:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ma</span> <span class="o">==</span> <span class="n">ma2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="c1">#print &quot;Meta info is equivalent:&quot;, ma.infoCopy() == ma2.infoCopy()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
    
    <span class="c1"># CSV write</span>
    
    <span class="c1"># append mode</span>
    
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">================append test (</span><span class="si">%s</span><span class="s2">)===============&quot;</span> <span class="o">%</span> <span class="n">tf</span><span class="p">)</span>
    <span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">appendAxis</span><span class="o">=</span><span class="s1">&#39;Axis2&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ma</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ma</span><span class="p">[</span><span class="s1">&#39;Axis2&#39;</span><span class="p">:[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">appendAxis</span><span class="o">=</span><span class="s1">&#39;Axis2&#39;</span><span class="p">)</span>
    
    <span class="n">ma2</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tf</span><span class="p">)</span>
    
    <span class="c1">#print ma2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Arrays are equivalent:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ma</span> <span class="o">==</span> <span class="n">ma2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="c1">#print &quot;Meta info is equivalent:&quot;, ma.infoCopy() == ma2.infoCopy()</span>
    
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>    
    
    
    
    <span class="c1">## memmap test</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">==========Memmap test============&quot;</span><span class="p">)</span>
    <span class="n">ma</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">mappable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ma2</span> <span class="o">=</span> <span class="n">MetaArray</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tf</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Arrays are equivalent:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ma</span> <span class="o">==</span> <span class="n">ma2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>    
    
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Richard A Kirian.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>