

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI &mdash; bornagain 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../../search.html"/>
    <link rel="top" title="bornagain 0.0.1 documentation" href="../../../../../../index.html"/>
        <link rel="up" title="bornagain.external.pyqtgraph.pyqtgraph" href="../../pyqtgraph.html"/> 

  
  <script src="../../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../../index.html" class="icon icon-home"> bornagain
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../bornagain.html">bornagain package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../modules.html">bornagain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../coding.html">Coding guidlines for developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">bornagain</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pyqtgraph.html">bornagain.external.pyqtgraph.pyqtgraph</a> &raquo;</li>
        
      <li>bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ROI.py -  Interactive graphics items for GraphicsView (ROI widgets)</span>
<span class="sd">Copyright 2010  Luke Campagnola</span>
<span class="sd">Distributed under MIT/X11 license. See license.txt for more infomation.</span>

<span class="sd">Implements a series of graphics items which display movable/scalable/rotatable shapes</span>
<span class="sd">for use as region-of-interest markers. ROI class automatically handles extraction </span>
<span class="sd">of array data from ImageItems.</span>

<span class="sd">The ROI class is meant to serve as the base for more specific types; see several examples</span>
<span class="sd">of how to build an ROI at the bottom of the file.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">..Qt</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#from numpy.linalg import norm</span>
<span class="kn">from</span> <span class="nn">..Point</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..SRTTransform</span> <span class="k">import</span> <span class="n">SRTTransform</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">fn</span>
<span class="kn">from</span> <span class="nn">.GraphicsObject</span> <span class="k">import</span> <span class="n">GraphicsObject</span>
<span class="kn">from</span> <span class="nn">.UIGraphicsItem</span> <span class="k">import</span> <span class="n">UIGraphicsItem</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;ROI&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;TestROI&#39;</span><span class="p">,</span> <span class="s1">&#39;RectROI&#39;</span><span class="p">,</span> <span class="s1">&#39;EllipseROI&#39;</span><span class="p">,</span> <span class="s1">&#39;CircleROI&#39;</span><span class="p">,</span> <span class="s1">&#39;PolygonROI&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;LineROI&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiLineROI&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiRectROI&#39;</span><span class="p">,</span> <span class="s1">&#39;LineSegmentROI&#39;</span><span class="p">,</span> <span class="s1">&#39;PolyLineROI&#39;</span><span class="p">,</span> <span class="s1">&#39;SpiralROI&#39;</span><span class="p">,</span> <span class="s1">&#39;CrosshairROI&#39;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">rectStr</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">] + [</span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>

<div class="viewcode-block" id="ROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI">[docs]</a><span class="k">class</span> <span class="nc">ROI</span><span class="p">(</span><span class="n">GraphicsObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic region-of-interest widget.</span>
<span class="sd">    </span>
<span class="sd">    Can be used for implementing many types of selection box with </span>
<span class="sd">    rotate/translate/scale handles.</span>
<span class="sd">    ROIs can be customized to have a variety of shapes (by subclassing or using</span>
<span class="sd">    any of the built-in subclasses) and any combination of draggable handles</span>
<span class="sd">    that allow the user to manipulate the ROI.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ================ ===========================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    pos              (length-2 sequence) Indicates the position of the ROI&#39;s </span>
<span class="sd">                     origin. For most ROIs, this is the lower-left corner of</span>
<span class="sd">                     its bounding rectangle.</span>
<span class="sd">    size             (length-2 sequence) Indicates the width and height of the </span>
<span class="sd">                     ROI.</span>
<span class="sd">    angle            (float) The rotation of the ROI in degrees. Default is 0.</span>
<span class="sd">    invertible       (bool) If True, the user may resize the ROI to have </span>
<span class="sd">                     negative width or height (assuming the ROI has scale</span>
<span class="sd">                     handles). Default is False.</span>
<span class="sd">    maxBounds        (QRect, QRectF, or None) Specifies boundaries that the ROI </span>
<span class="sd">                     cannot be dragged outside of by the user. Default is None.</span>
<span class="sd">    snapSize         (float) The spacing of snap positions used when *scaleSnap*</span>
<span class="sd">                     or *translateSnap* are enabled. Default is 1.0.</span>
<span class="sd">    scaleSnap        (bool) If True, the width and height of the ROI are forced</span>
<span class="sd">                     to be integer multiples of *snapSize* when being resized</span>
<span class="sd">                     by the user. Default is False.</span>
<span class="sd">    translateSnap    (bool) If True, the x and y positions of the ROI are forced</span>
<span class="sd">                     to be integer multiples of *snapSize* when being resized</span>
<span class="sd">                     by the user. Default is False.</span>
<span class="sd">    rotateSnap       (bool) If True, the ROI angle is forced to a multiple of </span>
<span class="sd">                     15 degrees when rotated by the user. Default is False.</span>
<span class="sd">    parent           (QGraphicsItem) The graphics item parent of this ROI. It</span>
<span class="sd">                     is generally not necessary to specify the parent.</span>
<span class="sd">    pen              (QPen or argument to pg.mkPen) The pen to use when drawing</span>
<span class="sd">                     the shape of the ROI.</span>
<span class="sd">    movable          (bool) If True, the ROI can be moved by dragging anywhere </span>
<span class="sd">                     inside the ROI. Default is True.</span>
<span class="sd">    removable        (bool) If True, the ROI will be given a context menu with</span>
<span class="sd">                     an option to remove the ROI. The ROI emits</span>
<span class="sd">                     sigRemoveRequested when this menu action is selected.</span>
<span class="sd">                     Default is False.</span>
<span class="sd">    ================ ===========================================================</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ======================= ====================================================</span>
<span class="sd">    **Signals**</span>
<span class="sd">    sigRegionChangeFinished Emitted when the user stops dragging the ROI (or</span>
<span class="sd">                            one of its handles) or if the ROI is changed</span>
<span class="sd">                            programatically.</span>
<span class="sd">    sigRegionChangeStarted  Emitted when the user starts dragging the ROI (or</span>
<span class="sd">                            one of its handles).</span>
<span class="sd">    sigRegionChanged        Emitted any time the position of the ROI changes,</span>
<span class="sd">                            including while it is being dragged by the user.</span>
<span class="sd">    sigHoverEvent           Emitted when the mouse hovers over the ROI.</span>
<span class="sd">    sigClicked              Emitted when the user clicks on the ROI.</span>
<span class="sd">                            Note that clicking is disabled by default to prevent</span>
<span class="sd">                            stealing clicks from objects behind the ROI. To </span>
<span class="sd">                            enable clicking, call </span>
<span class="sd">                            roi.setAcceptedMouseButtons(QtCore.Qt.LeftButton). </span>
<span class="sd">                            See QtGui.QGraphicsItem documentation for more </span>
<span class="sd">                            details.</span>
<span class="sd">    sigRemoveRequested      Emitted when the user selects &#39;remove&#39; from the </span>
<span class="sd">                            ROI&#39;s context menu (if available).</span>
<span class="sd">    ======================= ====================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">sigRegionChangeFinished</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigRegionChangeStarted</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigRegionChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigHoverEvent</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>
    <span class="n">sigRemoveRequested</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">invertible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">maxBounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">snapSize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">scaleSnap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">translateSnap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rotateSnap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">removable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">#QObjectWorkaround.__init__(self)</span>
        <span class="n">GraphicsObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoButton</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aspectLocked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translatable</span> <span class="o">=</span> <span class="n">movable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotateAllowed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removable</span> <span class="o">=</span> <span class="n">removable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHandleMoved</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">## keep track of whether free handles have moved since last change signal was emitted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseHovering</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">handlePen</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPen</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>  <span class="c1">## angle is in degrees for ease of Qt integration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastState</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAngle</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">handleSize</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invertible</span> <span class="o">=</span> <span class="n">invertible</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span> <span class="o">=</span> <span class="n">maxBounds</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span> <span class="o">=</span> <span class="n">snapSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translateSnap</span> <span class="o">=</span> <span class="n">translateSnap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotateSnap</span> <span class="o">=</span> <span class="n">rotateSnap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaleSnap</span> <span class="o">=</span> <span class="n">scaleSnap</span>
        <span class="c1">#self.setFlag(self.ItemIsSelectable, True)</span>
    
<div class="viewcode-block" id="ROI.getState"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getState">[docs]</a>    <span class="k">def</span> <span class="nf">getState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateCopy</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROI.stateCopy"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.stateCopy">[docs]</a>    <span class="k">def</span> <span class="nf">stateCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sc</span></div>
        
<div class="viewcode-block" id="ROI.saveState"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.saveState">[docs]</a>    <span class="k">def</span> <span class="nf">saveState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the state of the widget in a format suitable for storing to </span>
<span class="sd">        disk. (Points are converted to tuple)</span>
<span class="sd">        </span>
<span class="sd">        Combined with setState(), this allows ROIs to be easily saved and </span>
<span class="sd">        restored.&quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">state</span></div>
    
<div class="viewcode-block" id="ROI.setState"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setState">[docs]</a>    <span class="k">def</span> <span class="nf">setState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the state of the ROI from a structure generated by saveState() or</span>
<span class="sd">        getState().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAngle</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.setZValue"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setZValue">[docs]</a>    <span class="k">def</span> <span class="nf">setZValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
            <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.parentBounds"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.parentBounds">[docs]</a>    <span class="k">def</span> <span class="nf">parentBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the bounding rectangle of this ROI in the coordinate system</span>
<span class="sd">        of its parent.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROI.setPen"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setPen">[docs]</a>    <span class="k">def</span> <span class="nf">setPen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the pen to use when drawing the ROI shape.</span>
<span class="sd">        For arguments, see :func:`mkPen &lt;pyqtgraph.mkPen&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ROI.size"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.size">[docs]</a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the size (w,h) of the ROI.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="ROI.pos"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.pos">[docs]</a>    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the position (x,y) of the ROI&#39;s origin. </span>
<span class="sd">        For most ROIs, this will be the lower-left corner.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="ROI.angle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.angle">[docs]</a>    <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the angle of the ROI in degrees.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span></div>
        
<div class="viewcode-block" id="ROI.setPos"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setPos">[docs]</a>    <span class="k">def</span> <span class="nf">setPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the position of the ROI (in the parent&#39;s coordinate system).</span>
<span class="sd">        By default, this will cause both sigRegionChanged and sigRegionChangeFinished to be emitted.</span>
<span class="sd">        </span>
<span class="sd">        If finish is False, then sigRegionChangeFinished will not be emitted. You can then use </span>
<span class="sd">        stateChangeFinished() to cause the signal to be emitted after a series of state changes.</span>
<span class="sd">        </span>
<span class="sd">        If update is False, the state change will be remembered but not processed and no signals </span>
<span class="sd">        will be emitted. You can then use stateChanged() to complete the state change. This allows</span>
<span class="sd">        multiple change functions to be called sequentially while minimizing processing overhead</span>
<span class="sd">        and repeated signals. Setting update=False also forces finish=False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.setSize"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setSize">[docs]</a>    <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the size of the ROI. May be specified as a QPoint, Point, or list of two values.</span>
<span class="sd">        See setPos() for an explanation of the update and finish arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.setAngle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setAngle">[docs]</a>    <span class="k">def</span> <span class="nf">setAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the angle of rotation (in degrees) for this ROI.</span>
<span class="sd">        See setPos() for an explanation of the update and finish arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTransform</span><span class="p">()</span>
        <span class="c1">#tr.rotate(-angle * 180 / np.pi)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTransform</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.scale"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resize the ROI by scaling relative to *center*.</span>
<span class="sd">        See setPos() for an explanation of the *update* and *finish* arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span>
        <span class="n">newSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span> <span class="o">*</span> <span class="n">newSize</span><span class="p">)</span>
        <span class="n">newPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span> <span class="o">-</span> <span class="n">c1</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">newSize</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">newPos</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
        
   
<div class="viewcode-block" id="ROI.translate"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the ROI to a new position.</span>
<span class="sd">        Accepts either (x, y, snap) or ([x,y], snap) as arguments</span>
<span class="sd">        If the ROI is bounded and the move would exceed boundaries, then the ROI</span>
<span class="sd">        is moved to the nearest acceptable position instead.</span>
<span class="sd">        </span>
<span class="sd">        *snap* can be:</span>
<span class="sd">        </span>
<span class="sd">        =============== ==========================================================================</span>
<span class="sd">        None (default)  use self.translateSnap and self.snapSize to determine whether/how to snap</span>
<span class="sd">        False           do not snap</span>
<span class="sd">        Point(w,h)      snap to rectangular grid with spacing (w,h)</span>
<span class="sd">        True            snap using self.snapSize (and ignoring self.translateSnap)</span>
<span class="sd">        =============== ==========================================================================</span>
<span class="sd">           </span>
<span class="sd">        Also accepts *update* and *finish* arguments (see setPos() for a description of these).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">args</span>
            
        <span class="n">newState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateCopy</span><span class="p">()</span>
        <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span>
        
        <span class="c1">## snap position</span>
        <span class="c1">#snap = kargs.get(&#39;snap&#39;, None)</span>
        <span class="c1">#if (snap is not False)   and   not (snap is None and self.translateSnap is False):</span>
        
        <span class="n">snap</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;snap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">snap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">snap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translateSnap</span>
        <span class="k">if</span> <span class="n">snap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSnapPosition</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">snap</span><span class="o">=</span><span class="n">snap</span><span class="p">)</span>
        
        <span class="c1">#d = ev.scenePos() - self.mapToScene(self.pressPos)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateRect</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span>
            <span class="c1">#r0 = self.sceneTransform().mapRect(self.boundingRect())</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">left</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">left</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">left</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">right</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">right</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">right</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">right</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">top</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">top</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">top</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span><span class="p">():</span>
                <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">bottom</span><span class="p">()</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span>
        
        <span class="c1">#self.state[&#39;pos&#39;] = newState[&#39;pos&#39;]</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
        <span class="c1">#if &#39;update&#39; not in kargs or kargs[&#39;update&#39;] is True:</span>
        <span class="c1">#self.stateChanged()</span>

<div class="viewcode-block" id="ROI.rotate"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate the ROI by *angle* degrees. </span>
<span class="sd">        </span>
<span class="sd">        Also accepts *update* and *finish* arguments (see setPos() for a </span>
<span class="sd">        description of these).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAngle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">()</span><span class="o">+</span><span class="n">angle</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROI.handleMoveStarted"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.handleMoveStarted">[docs]</a>    <span class="k">def</span> <span class="nf">handleMoveStarted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preMoveState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ROI.addTranslateHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addTranslateHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addTranslateHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new translation handle to the ROI. Dragging the handle will move </span>
<span class="sd">        the entire ROI without changing its angle or shape. </span>
<span class="sd">        </span>
<span class="sd">        Note that, by default, ROIs may be moved by dragging anywhere inside the</span>
<span class="sd">        ROI. However, for larger ROIs it may be desirable to disable this and</span>
<span class="sd">        instead provide one or more translation handles.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addFreeHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addFreeHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addFreeHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new free handle to the ROI. Dragging free handles has no effect</span>
<span class="sd">        on the position or shape of the ROI. </span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addScaleHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addScaleHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addScaleHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lockAspect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new scale handle to the ROI. Dragging a scale handle allows the</span>
<span class="sd">        user to change the height and/or width of the ROI.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        center              (length-2 sequence) The center point around which </span>
<span class="sd">                            scaling takes place. If the center point has the</span>
<span class="sd">                            same x or y value as the handle position, then </span>
<span class="sd">                            scaling will be disabled for that axis.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s1">&#39;lockAspect&#39;</span><span class="p">:</span> <span class="n">lockAspect</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">==</span> <span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">():</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;xoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">==</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">():</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;yoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addRotateHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addRotateHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addRotateHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new rotation handle to the ROI. Dragging a rotation handle allows </span>
<span class="sd">        the user to change the angle of the ROI.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        center              (length-2 sequence) The center point around which </span>
<span class="sd">                            rotation takes place.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addScaleRotateHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addScaleRotateHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addScaleRotateHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new scale+rotation handle to the ROI. When dragging a handle of </span>
<span class="sd">        this type, the user can simultaneously rotate the ROI around an </span>
<span class="sd">        arbitrary center point as well as scale the ROI by dragging the handle</span>
<span class="sd">        toward or away from the center point.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        center              (length-2 sequence) The center point around which </span>
<span class="sd">                            scaling and rotation take place.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Scale/rotate handles must have either the same x or y coordinate as their center point.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;sr&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addRotateFreeHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addRotateFreeHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addRotateFreeHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new rotation+free handle to the ROI. When dragging a handle of </span>
<span class="sd">        this type, the user can rotate the ROI around an </span>
<span class="sd">        arbitrary center point, while moving toward or away from the center </span>
<span class="sd">        point has no effect on the shape of the ROI.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        pos                 (length-2 sequence) The position of the handle </span>
<span class="sd">                            relative to the shape of the ROI. A value of (0,0)</span>
<span class="sd">                            indicates the origin, whereas (1, 1) indicates the</span>
<span class="sd">                            upper-right corner, regardless of the ROI&#39;s size.</span>
<span class="sd">        center              (length-2 sequence) The center point around which </span>
<span class="sd">                            rotation takes place.</span>
<span class="sd">        item                The Handle instance to add. If None, a new handle</span>
<span class="sd">                            will be created.</span>
<span class="sd">        name                The name of this handle (optional). Handles are </span>
<span class="sd">                            identified by name when calling </span>
<span class="sd">                            getLocalHandlePositions and getSceneHandlePositions.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span> <span class="n">center</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">pos</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.addHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.addHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">## If a Handle was not supplied, create it now</span>
        <span class="k">if</span> <span class="s1">&#39;item&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span> <span class="ow">or</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">Handle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handleSize</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">handlePen</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">h</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            
        <span class="c1">## connect the handle to this ROI</span>
        <span class="c1">#iid = len(self.handles)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">connectROI</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        
        <span class="n">h</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zValue</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">h</span></div>
    
<div class="viewcode-block" id="ROI.indexOfHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.indexOfHandle">[docs]</a>    <span class="k">def</span> <span class="nf">indexOfHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the index of *handle* in the list of this ROI&#39;s handles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">Handle</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">handle</span><span class="p">]</span>    
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot remove handle; it is not attached to this ROI&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle</span></div>
        
<div class="viewcode-block" id="ROI.removeHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.removeHandle">[docs]</a>    <span class="k">def</span> <span class="nf">removeHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a handle from this ROI. Argument may be either a Handle </span>
<span class="sd">        instance or the integer index of the handle.&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOfHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            
        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">disconnectROI</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">rois</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ROI.replaceHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.replaceHandle">[docs]</a>    <span class="k">def</span> <span class="nf">replaceHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldHandle</span><span class="p">,</span> <span class="n">newHandle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace one handle in the ROI for another. This is useful when </span>
<span class="sd">        connecting multiple ROIs together.</span>
<span class="sd">        </span>
<span class="sd">        *oldHandle* may be a Handle instance or the index of a handle to be</span>
<span class="sd">        replaced.&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOfHandle</span><span class="p">(</span><span class="n">oldHandle</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newHandle</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newHandle</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addHandle</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.checkRemoveHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.checkRemoveHandle">[docs]</a>    <span class="k">def</span> <span class="nf">checkRemoveHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">):</span>
        <span class="c1">## This is used when displaying a Handle&#39;s context menu to determine</span>
        <span class="c1">## whether removing is allowed. </span>
        <span class="c1">## Subclasses may wish to override this to disable the menu entry.</span>
        <span class="c1">## Note: by default, handles are not user-removable even if this method returns True.</span>
        <span class="k">return</span> <span class="kc">True</span></div>
        
        
<div class="viewcode-block" id="ROI.getLocalHandlePositions"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getLocalHandlePositions">[docs]</a>    <span class="k">def</span> <span class="nf">getLocalHandlePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the position of handles in the ROI&#39;s coordinate system.</span>
<span class="sd">        </span>
<span class="sd">        The format returned is a list of (name, pos) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">positions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span></div>
            
<div class="viewcode-block" id="ROI.getSceneHandlePositions"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getSceneHandlePositions">[docs]</a>    <span class="k">def</span> <span class="nf">getSceneHandlePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the position of handles in the scene coordinate system.</span>
<span class="sd">        </span>
<span class="sd">        The format returned is a list of (name, pos) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">positions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())</span></div>
        
<div class="viewcode-block" id="ROI.getHandles"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getHandles">[docs]</a>    <span class="k">def</span> <span class="nf">getHandles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of this ROI&#39;s Handles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="ROI.mapSceneToParent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.mapSceneToParent">[docs]</a>    <span class="k">def</span> <span class="nf">mapSceneToParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span></div>

<div class="viewcode-block" id="ROI.setSelected"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setSelected">[docs]</a>    <span class="k">def</span> <span class="nf">setSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsItem</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="c1">#print &quot;select&quot;, self, s</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
                <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
                <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>


<div class="viewcode-block" id="ROI.hoverEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.hoverEvent">[docs]</a>    <span class="k">def</span> <span class="nf">hoverEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">hover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ev</span><span class="o">.</span><span class="n">isExit</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translatable</span> <span class="ow">and</span> <span class="n">ev</span><span class="o">.</span><span class="n">acceptDrags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">):</span>
                <span class="n">hover</span><span class="o">=</span><span class="kc">True</span>
                
            <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">btn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">btn</span><span class="p">):</span>
                    <span class="n">hover</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEnabled</span><span class="p">():</span>
                <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">hover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMouseHover</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigHoverEvent</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>  <span class="c1">## If the ROI is hilighted, we should accept all clicks to avoid confusion.</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">)</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMouseHover</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROI.setMouseHover"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.setMouseHover">[docs]</a>    <span class="k">def</span> <span class="nf">setMouseHover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hover</span><span class="p">):</span>
        <span class="c1">## Inform the ROI that the mouse is(not) hovering over it</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseHovering</span> <span class="o">==</span> <span class="n">hover</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseHovering</span> <span class="o">=</span> <span class="n">hover</span>
        <span class="k">if</span> <span class="n">hover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROI.contextMenuEnabled"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.contextMenuEnabled">[docs]</a>    <span class="k">def</span> <span class="nf">contextMenuEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">removable</span></div>
    
<div class="viewcode-block" id="ROI.raiseContextMenu"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.raiseContextMenu">[docs]</a>    <span class="k">def</span> <span class="nf">raiseContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEnabled</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenu</span><span class="p">()</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">addParentContextMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menu</span><span class="p">,</span> <span class="n">ev</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">screenPos</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">popup</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()))</span></div>

<div class="viewcode-block" id="ROI.getMenu"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getMenu">[docs]</a>    <span class="k">def</span> <span class="nf">getMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;ROI&quot;</span><span class="p">)</span>
            <span class="n">remAct</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Remove ROI&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">)</span>
            <span class="n">remAct</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removeClicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">remAct</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">remAct</span> <span class="o">=</span> <span class="n">remAct</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span></div>

<div class="viewcode-block" id="ROI.removeClicked"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.removeClicked">[docs]</a>    <span class="k">def</span> <span class="nf">removeClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## Send remove event only after we have exited the menu event handler</span>
        <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="o">.</span><span class="n">singleShot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigRemoveRequested</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="ROI.mouseDragEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.mouseDragEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseDragEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">isStart</span><span class="p">():</span>
            <span class="c1">#p = ev.pos()</span>
            <span class="c1">#if not self.isMoving and not self.shape().contains(p):</span>
                <span class="c1">#ev.ignore()</span>
                <span class="c1">#return        </span>
            <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translatable</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">preMoveState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cursorOffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">buttonDownPos</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChangeStarted</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ev</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">ev</span><span class="o">.</span><span class="n">isFinish</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translatable</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stateChangeFinished</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translatable</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="ow">and</span> <span class="n">ev</span><span class="o">.</span><span class="n">buttons</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="n">snap</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">modifiers</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">newPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorOffset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">newPos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">(),</span> <span class="n">snap</span><span class="o">=</span><span class="n">snap</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ROI.mouseClickEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.mouseClickEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancelMove</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEnabled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raiseContextMenu</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROI.cancelMove"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.cancelMove">[docs]</a>    <span class="k">def</span> <span class="nf">cancelMove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preMoveState</span><span class="p">)</span></div>

<div class="viewcode-block" id="ROI.checkPointMove"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.checkPointMove">[docs]</a>    <span class="k">def</span> <span class="nf">checkPointMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When handles move, they must ask the ROI if the move is acceptable.</span>
<span class="sd">        By default, this always returns True. Subclasses may wish override.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ROI.movePoint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.movePoint">[docs]</a>    <span class="k">def</span> <span class="nf">movePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeyboardModifier</span><span class="p">(),</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;parent&#39;</span><span class="p">):</span>
        <span class="c1">## called by Handles when they are moved. </span>
        <span class="c1">## pos is the new position of the handle in scene coords, as requested by the handle.</span>
        
        <span class="n">newState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateCopy</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexOfHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">coords</span> <span class="o">==</span> <span class="s1">&#39;parent&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">coords</span> <span class="o">==</span> <span class="s1">&#39;scene&#39;</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapSceneToParent</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;New point location must be given in either &#39;parent&#39; or &#39;scene&#39; coordinates.&quot;</span><span class="p">)</span>

        
        <span class="c1">## transform p0 and p1 into parent&#39;s coordinates (same as scene coords if there is no parent). I forget why.</span>
        <span class="c1">#p0 = self.mapSceneToParent(p0)</span>
        <span class="c1">#p1 = self.mapSceneToParent(p1)</span>

        <span class="c1">## Handles with a &#39;center&#39; need to know their local position relative to the center point (lp0, lp1)</span>
        <span class="k">if</span> <span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">]</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="n">lp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromParent</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">-</span> <span class="n">cs</span>
            <span class="n">lp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromParent</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cs</span>
        
        <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="n">snap</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="c1">#if self.translateSnap or ():</span>
                <span class="c1">#snap = Point(self.snapSize, self.snapSize)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p0</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="n">snap</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">newPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromParent</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">newPos</span><span class="p">)</span>
            <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newPos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freeHandleMoved</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1">#self.sigRegionChanged.emit(self)  ## should be taken care of by call to stateChanged()</span>
            
        <span class="k">elif</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
            <span class="c1">## If a handle and its center have the same x or y value, we can&#39;t scale across that axis.</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">lp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">lp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="c1">## snap </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleSnap</span> <span class="ow">or</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">):</span>
                <span class="n">lp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span>
                <span class="n">lp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lp1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span>
                
            <span class="c1">## preserve aspect ratio (this can override snapping)</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;lockAspect&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AltModifier</span><span class="p">):</span>
                <span class="c1">#arv = Point(self.preMoveState[&#39;size&#39;]) - </span>
                <span class="n">lp1</span> <span class="o">=</span> <span class="n">lp1</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">lp0</span><span class="p">)</span>
            
            <span class="c1">## determine scale factors and new size of ROI</span>
            <span class="n">hs</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span>
            <span class="k">if</span> <span class="n">hs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">hs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">hs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">hs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">newSize</span> <span class="o">=</span> <span class="n">lp1</span> <span class="o">/</span> <span class="n">hs</span>
            
            <span class="c1">## Perform some corrections and limit checks</span>
            <span class="k">if</span> <span class="n">newSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">newSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">newSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">newSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">invertible</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">newSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">newSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">newSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">newSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspectLocked</span><span class="p">:</span>
                <span class="n">newSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1">## Move ROI so the center point occupies the same scene location after the scale</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">newSize</span>
            <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">s0</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            
            <span class="c1">## update state, do more boundary checks</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newSize</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cc</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateRect</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                    <span class="k">return</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;rf&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rf&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freeHandleMoved</span> <span class="o">=</span> <span class="kc">True</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotateAllowed</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1">## If the handle is directly over its center point, we can&#39;t compute an angle.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lp1</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lp0</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
                <span class="k">return</span>
            
            <span class="c1">## determine new rotation angle, constrained if necessary</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">lp0</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">lp1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1">## this should never happen..</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotateSnap</span> <span class="ow">or</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">):</span>
                <span class="n">ang</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ang</span> <span class="o">/</span> <span class="mf">15.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">15.</span>  <span class="c1">## 180/12 = 15</span>
            
            <span class="c1">## create rotation transform</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTransform</span><span class="p">()</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            
            <span class="c1">## move ROI so that center point remains stationary after rotate</span>
            <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cc</span>
            
            <span class="c1">## check boundaries, update</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateRect</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="c1">#self.setTransform(tr)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">],</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAngle</span><span class="p">(</span><span class="n">ang</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#self.state = newState</span>
            
            <span class="c1">## If this is a free-rotate handle, its distance from the center may change.</span>
            
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rf&#39;</span><span class="p">:</span>
                <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>  <span class="c1">## changes ROI coordinates of handle</span>
                
        <span class="k">elif</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sr&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">scaleAxis</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">nonScaleAxis</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scaleAxis</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">nonScaleAxis</span><span class="o">=</span><span class="mi">1</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lp1</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lp0</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">except</span> <span class="ne">OverflowError</span><span class="p">:</span>
                <span class="k">return</span>
            
            <span class="n">ang</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">lp0</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">lp1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotateSnap</span> <span class="ow">or</span> <span class="p">(</span><span class="n">modifiers</span> <span class="o">&amp;</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ControlModifier</span><span class="p">):</span>
                <span class="c1">#ang = round(ang / (np.pi/12.)) * (np.pi/12.)</span>
                <span class="n">ang</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ang</span> <span class="o">/</span> <span class="mf">15.</span><span class="p">)</span> <span class="o">*</span> <span class="mf">15.</span>
            
            <span class="n">hs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">c</span><span class="p">[</span><span class="n">scaleAxis</span><span class="p">])</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">lp1</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">/</span> <span class="n">hs</span>
            <span class="c1">#if self.scaleSnap or (modifiers &amp; QtCore.Qt.ControlModifier):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleSnap</span><span class="p">:</span>  <span class="c1">## use CTRL only for angular snap here.</span>
                <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span>
            <span class="k">if</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspectLocked</span><span class="p">:</span>
                <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">nonScaleAxis</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="n">scaleAxis</span><span class="p">]</span>
                
            <span class="n">c1</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTransform</span><span class="p">()</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            
            <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ang</span>
            <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newState</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cc</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateRect</span><span class="p">(</span><span class="n">newState</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxBounds</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                    <span class="k">return</span>
            <span class="c1">#self.setTransform(tr)</span>
            <span class="c1">#self.setPos(newState[&#39;pos&#39;], update=False)</span>
            <span class="c1">#self.prepareGeometryChange()</span>
            <span class="c1">#self.state = newState</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">newState</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">(</span><span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.stateChanged"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.stateChanged">[docs]</a>    <span class="k">def</span> <span class="nf">stateChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process changes to the state of the ROI.</span>
<span class="sd">        If there are any changes, then the positions of handles are updated accordingly</span>
<span class="sd">        and sigRegionChanged is emitted. If finish is True, then </span>
<span class="sd">        sigRegionChangeFinished will also be emitted.&quot;&quot;&quot;</span>
        
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastState</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastState</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
            <span class="c1">## Move all handles to match the current configuration of the ROI</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">childItems</span><span class="p">():</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span>
                    <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
                <span class="c1">#else:</span>
                <span class="c1">#    trans = self.state[&#39;pos&#39;]-self.lastState[&#39;pos&#39;]</span>
                <span class="c1">#    h[&#39;item&#39;].setPos(h[&#39;pos&#39;] + h[&#39;item&#39;].parentItem().mapFromParent(trans))</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">freeHandleMoved</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">freeHandleMoved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stateCopy</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">finish</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stateChangeFinished</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ROI.stateChangeFinished"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.stateChangeFinished">[docs]</a>    <span class="k">def</span> <span class="nf">stateChangeFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChangeFinished</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.stateRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.stateRect">[docs]</a>    <span class="k">def</span> <span class="nf">stateRect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTransform</span><span class="p">()</span>
        <span class="c1">#tr.rotate(-state[&#39;angle&#39;] * 180 / np.pi)</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">mapRect</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">adjusted</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span></div>
    
    
<div class="viewcode-block" id="ROI.getSnapPosition"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getSnapPosition">[docs]</a>    <span class="k">def</span> <span class="nf">getSnapPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">## Given that pos has been requested, return the nearest snap-to position</span>
        <span class="c1">## optionally, snap may be passed in to specify a rectangular snap grid.</span>
        <span class="c1">## override this function for more interesting snap functionality..</span>
        
        <span class="k">if</span> <span class="n">snap</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">snap</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pos</span>
            <span class="n">snap</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapSize</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span>
            <span class="nb">round</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">snap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">snap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">round</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">snap</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">snap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span></div>
    
<div class="viewcode-block" id="ROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span></div>

<div class="viewcode-block" id="ROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="c1"># p.save()</span>
        <span class="c1"># Note: don&#39;t use self.boundingRect here, because subclasses may need to redefine it.</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">top</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>
        <span class="c1"># p.restore()</span>

<div class="viewcode-block" id="ROI.getArraySlice"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getArraySlice">[docs]</a>    <span class="k">def</span> <span class="nf">getArraySlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">returnSlice</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple of slice objects that can be used to slice the region from data covered by this ROI.</span>
<span class="sd">        Also returns the transform which maps the ROI into data coordinates.</span>
<span class="sd">        </span>
<span class="sd">        If returnSlice is set to False, the function returns a pair of tuples with the values that would have </span>
<span class="sd">        been used to generate the slice objects. ((ax0Start, ax0Stop), (ax1Start, ax1Stop))</span>
<span class="sd">        </span>
<span class="sd">        If the slice can not be computed (usually because the scene/transforms are not properly</span>
<span class="sd">        constructed yet), then the method returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print &quot;getArraySlice&quot;</span>
        
        <span class="c1">## Determine shape of array along ROI axes</span>
        <span class="n">dShape</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="c1">#print &quot;  dshape&quot;, dShape</span>
        
        <span class="c1">## Determine transform that maps ROI bounding box to image coordinates</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sceneTransform</span><span class="p">()</span> <span class="o">*</span> <span class="n">fn</span><span class="o">.</span><span class="n">invertQTransform</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">sceneTransform</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
            
        <span class="c1">## Modify transform to scale from image coords to data coords</span>
        <span class="c1">#m = QtGui.QTransform()</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dShape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="n">dShape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">img</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>
        <span class="c1">#tr = tr * m</span>
        
        <span class="c1">## Transform ROI bounds into data bounds</span>
        <span class="n">dataBounds</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">mapRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="c1">#print &quot;  boundingRect:&quot;, self.boundingRect()</span>
        <span class="c1">#print &quot;  dataBounds:&quot;, dataBounds</span>
        
        <span class="c1">## Intersect transformed ROI bounds with data bounds</span>
        <span class="n">intBounds</span> <span class="o">=</span> <span class="n">dataBounds</span><span class="o">.</span><span class="n">intersected</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dShape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dShape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#print &quot;  intBounds:&quot;, intBounds</span>
        
        <span class="c1">## Determine index values to use when referencing the array. </span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">intBounds</span><span class="o">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">intBounds</span><span class="o">.</span><span class="n">right</span><span class="p">())),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">intBounds</span><span class="o">.</span><span class="n">left</span><span class="p">(),</span> <span class="n">intBounds</span><span class="o">.</span><span class="n">right</span><span class="p">()))),</span>
            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">intBounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">(),</span> <span class="n">intBounds</span><span class="o">.</span><span class="n">top</span><span class="p">())),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">max</span><span class="p">(</span><span class="n">intBounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">(),</span> <span class="n">intBounds</span><span class="o">.</span><span class="n">top</span><span class="p">())))</span>
        <span class="p">)</span>
        <span class="c1">#print &quot;  bounds:&quot;, bounds</span>
        
        <span class="k">if</span> <span class="n">returnSlice</span><span class="p">:</span>
            <span class="c1">## Create slice objects</span>
            <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
            <span class="n">sl</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sl</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">sl</span><span class="p">),</span> <span class="n">tr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">tr</span></div>

<div class="viewcode-block" id="ROI.getArrayRegion"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getArrayRegion">[docs]</a>    <span class="k">def</span> <span class="nf">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">returnMappedCoords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use the position and orientation of this ROI relative to an imageItem </span>
<span class="sd">        to pull a slice from an array.</span>
<span class="sd">        </span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        data                The array to slice from. Note that this array does</span>
<span class="sd">                            *not* have to be the same data that is represented</span>
<span class="sd">                            in *img*.</span>
<span class="sd">        img                 (ImageItem or other suitable QGraphicsItem)</span>
<span class="sd">                            Used to determine the relationship between the </span>
<span class="sd">                            ROI and the boundaries of *data*.</span>
<span class="sd">        axes                (length-2 tuple) Specifies the axes in *data* that</span>
<span class="sd">                            correspond to the x and y axes of *img*.</span>
<span class="sd">        returnMappedCoords  (bool) If True, the array slice is returned along</span>
<span class="sd">                            with a corresponding array of coordinates that were</span>
<span class="sd">                            used to extract data from the original array.</span>
<span class="sd">        \**kwds             All keyword arguments are passed to </span>
<span class="sd">                            :func:`affineSlice &lt;pyqtgraph.affineSlice&gt;`.</span>
<span class="sd">        =================== ====================================================</span>
<span class="sd">        </span>
<span class="sd">        This method uses :func:`affineSlice &lt;pyqtgraph.affineSlice&gt;` to generate</span>
<span class="sd">        the slice from *data* and uses :func:`getAffineSliceParams &lt;pyqtgraph.ROI.getAffineSliceParams&gt;`</span>
<span class="sd">        to determine the parameters to pass to :func:`affineSlice &lt;pyqtgraph.affineSlice&gt;`.</span>
<span class="sd">        </span>
<span class="sd">        If *returnMappedCoords* is True, then the method returns a tuple (result, coords) </span>
<span class="sd">        such that coords is the set of coordinates used to interpolate values from the original</span>
<span class="sd">        data, mapped into the parent coordinate system of the image. This is useful, when slicing</span>
<span class="sd">        data from images that have been transformed, for determining the location of each value</span>
<span class="sd">        in the sliced data.</span>
<span class="sd">        </span>
<span class="sd">        All extra keyword arguments are passed to :func:`affineSlice &lt;pyqtgraph.affineSlice&gt;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">shape</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAffineSliceParams</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">returnMappedCoords</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fn</span><span class="o">.</span><span class="n">affineSlice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="n">vectors</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;returnCoords&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">affineSlice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">vectors</span><span class="o">=</span><span class="n">vectors</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            
            <span class="c1">### map coordinates and return</span>
            <span class="n">mapped</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">transformCoordinates</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">transform</span><span class="p">(),</span> <span class="n">coords</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">mapped</span></div>

<div class="viewcode-block" id="ROI.getAffineSliceParams"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getAffineSliceParams">[docs]</a>    <span class="k">def</span> <span class="nf">getAffineSliceParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the parameters needed to use :func:`affineSlice &lt;pyqtgraph.affineSlice&gt;`</span>
<span class="sd">        (shape, vectors, origin) to extract a subset of *data* using this ROI </span>
<span class="sd">        and *img* to specify the subset.</span>
<span class="sd">        </span>
<span class="sd">        See :func:`getArrayRegion &lt;pyqtgraph.ROI.getArrayRegion&gt;` for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">img</span><span class="o">.</span><span class="n">scene</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ROI and target item must be members of the same scene.&quot;</span><span class="p">)</span>
        
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToItem</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        
        <span class="c1">## vx and vy point in the directions of the slice axes, but must be scaled properly</span>
        <span class="n">vx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToItem</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">origin</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToItem</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">origin</span>
        
        <span class="n">lvx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vx</span><span class="o">.</span><span class="n">y</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">lvy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vy</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">.</span><span class="n">y</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pxLen</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c1">#img.width is number of pixels or width of item?</span>
        <span class="c1">#need pxWidth and pxHeight instead of pxLen ?</span>
        <span class="n">sx</span> <span class="o">=</span>  <span class="n">pxLen</span> <span class="o">/</span> <span class="n">lvx</span>
        <span class="n">sy</span> <span class="o">=</span>  <span class="n">pxLen</span> <span class="o">/</span> <span class="n">lvy</span>
        
        <span class="n">vectors</span> <span class="o">=</span> <span class="p">((</span><span class="n">vx</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="o">*</span><span class="n">sx</span><span class="p">,</span> <span class="n">vx</span><span class="o">.</span><span class="n">y</span><span class="p">()</span><span class="o">*</span><span class="n">sx</span><span class="p">),</span> <span class="p">(</span><span class="n">vy</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="o">*</span><span class="n">sy</span><span class="p">,</span> <span class="n">vy</span><span class="o">.</span><span class="n">y</span><span class="p">()</span><span class="o">*</span><span class="n">sy</span><span class="p">))</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">sx</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">sy</span><span class="p">)]</span>
        
        <span class="n">origin</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">origin</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">vectors</span><span class="p">,</span> <span class="n">origin</span></div>
        
<div class="viewcode-block" id="ROI.getGlobalTransform"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.getGlobalTransform">[docs]</a>    <span class="k">def</span> <span class="nf">getGlobalTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeTo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return global transformation (rotation angle+translation) required to move </span>
<span class="sd">        from relative state to current state. If relative state isn&#39;t specified,</span>
<span class="sd">        then we use the state of the ROI when mouse is pressed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">relativeTo</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">relativeTo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preMoveState</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span>
        
        <span class="c1">## this is only allowed because we will be comparing the two </span>
        <span class="n">relativeTo</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relativeTo</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        <span class="n">st</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        
        <span class="n">t1</span> <span class="o">=</span> <span class="n">SRTTransform</span><span class="p">(</span><span class="n">relativeTo</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">SRTTransform</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t2</span><span class="o">/</span><span class="n">t1</span></div>
        
        
        <span class="c1">#st = self.getState()</span>
        
        <span class="c1">### rotation</span>
        <span class="c1">#ang = (st[&#39;angle&#39;]-relativeTo[&#39;angle&#39;]) * 180. / 3.14159265358</span>
        <span class="c1">#rot = QtGui.QTransform()</span>
        <span class="c1">#rot.rotate(-ang)</span>

        <span class="c1">### We need to come up with a universal transformation--one that can be applied to other objects </span>
        <span class="c1">### such that all maintain alignment. </span>
        <span class="c1">### More specifically, we need to turn the ROI&#39;s position and angle into</span>
        <span class="c1">### a rotation _around the origin_ and a translation.</span>
        
        <span class="c1">#p0 = Point(relativeTo[&#39;pos&#39;])</span>

        <span class="c1">### base position, rotated</span>
        <span class="c1">#p1 = rot.map(p0)</span>
        
        <span class="c1">#trans = Point(st[&#39;pos&#39;]) - p1</span>
        <span class="c1">#return trans, ang</span>

<div class="viewcode-block" id="ROI.applyGlobalTransform"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.ROI.applyGlobalTransform">[docs]</a>    <span class="k">def</span> <span class="nf">applyGlobalTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()</span>
        
        <span class="n">st</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">SRTTransform</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="p">(</span><span class="n">st</span> <span class="o">*</span> <span class="n">tr</span><span class="p">)</span><span class="o">.</span><span class="n">saveState</span><span class="p">()</span>
        <span class="n">st</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="n">st</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">Handle</span><span class="p">(</span><span class="n">UIGraphicsItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handle represents a single user-interactable point attached to an ROI. They</span>
<span class="sd">    are usually created by a call to one of the ROI.add___Handle() methods.</span>
<span class="sd">    </span>
<span class="sd">    Handles are represented as a square, diamond, or circle, and are drawn with </span>
<span class="sd">    fixed pixel size regardless of the scaling of the view they are displayed in.</span>
<span class="sd">    </span>
<span class="sd">    Handles may be dragged to change the position, size, orientation, or other</span>
<span class="sd">    properties of the ROI they are attached to.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">{</span>   <span class="c1">## defines number of sides, start angle for each handle type</span>
        <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span>
        <span class="s1">&#39;f&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> 
        <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;sr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;rf&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">sigClicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">)</span>   <span class="c1"># self, event</span>
    <span class="n">sigRemoveRequested</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>   <span class="c1"># self</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deletable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1">#print &quot;   create item with parent&quot;, parent</span>
        <span class="c1">#self.bounds = QtCore.QRectF(-1e-10, -1e-10, 2e-10, 2e-10)</span>
        <span class="c1">#self.setFlags(self.ItemIgnoresTransformations | self.ItemSendsScenePositionChanges)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen</span><span class="o">.</span><span class="n">setCosmetic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sides</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startAng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildPath</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildMenu</span><span class="p">()</span>
        
        <span class="n">UIGraphicsItem</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletable</span> <span class="o">=</span> <span class="n">deletable</span>
        <span class="k">if</span> <span class="n">deletable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">)</span>        
        <span class="c1">#self.updateShape()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">connectROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roi</span><span class="p">):</span>
        <span class="c1">### roi is the &quot;parent&quot; roi, i is the index of the handle in roi.handles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">disconnectROI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
        <span class="c1">#for i, r in enumerate(self.roi):</span>
            <span class="c1">#if r[0] == roi:</span>
                <span class="c1">#self.roi.pop(i)</span>
                
    <span class="c1">#def close(self):</span>
        <span class="c1">#for r in self.roi:</span>
            <span class="c1">#r.removeHandle(self)</span>
            
    <span class="k">def</span> <span class="nf">setDeletable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deletable</span> <span class="o">=</span> <span class="n">b</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">()</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">removeClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRemoveRequested</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hoverEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">hover</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ev</span><span class="o">.</span><span class="n">isExit</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">acceptDrags</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">):</span>
                <span class="n">hover</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">btn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ev</span><span class="o">.</span><span class="n">acceptClicks</span><span class="p">(</span><span class="n">btn</span><span class="p">):</span>
                    <span class="n">hover</span><span class="o">=</span><span class="kc">True</span>
                    
        <span class="k">if</span> <span class="n">hover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1">#if (not ev.isExit()) and ev.acceptDrags(QtCore.Qt.LeftButton):</span>
            <span class="c1">#self.currentPen = fn.mkPen(255, 255,0)</span>
        <span class="c1">#else:</span>
            <span class="c1">#self.currentPen = self.pen</span>
        <span class="c1">#self.update()</span>
            


    <span class="k">def</span> <span class="nf">mouseClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="c1">## right-click cancels drag</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">## prevents any further motion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPos</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1">#for r in self.roi:</span>
                <span class="c1">#r[0].cancelMove()</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">deletable</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">raiseContextMenu</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigClicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ev</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>        
            
            <span class="c1">#elif self.deletable:</span>
                <span class="c1">#ev.accept()</span>
                <span class="c1">#self.raiseContextMenu(ev)</span>
            <span class="c1">#else:</span>
                <span class="c1">#ev.ignore()</span>
                
    <span class="k">def</span> <span class="nf">buildMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">&quot;Handle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeAction</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Remove handle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">removeClicked</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">menu</span>
        
    <span class="k">def</span> <span class="nf">getMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span>

    <span class="k">def</span> <span class="nf">raiseContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">addParentContextMenus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMenu</span><span class="p">(),</span> <span class="n">ev</span><span class="p">)</span>
        
        <span class="c1">## Make sure it is still ok to remove this handle</span>
        <span class="n">removeAllowed</span> <span class="o">=</span> <span class="nb">all</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">checkRemoveHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeAction</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">removeAllowed</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">screenPos</span><span class="p">()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">popup</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPoint</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">()))</span>    

    <span class="k">def</span> <span class="nf">mouseDragEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">ev</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        
        <span class="c1">## Inform ROIs that a drag is happening </span>
        <span class="c1">##  note: the ROI is informed that the handle has moved using ROI.movePoint</span>
        <span class="c1">##  this is for other (more nefarious) purposes.</span>
        <span class="c1">#for r in self.roi:</span>
            <span class="c1">#r[0].pointDragEvent(r[1], ev)</span>
            
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">isFinish</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">:</span>
                    <span class="n">r</span><span class="o">.</span><span class="n">stateChangeFinished</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">ev</span><span class="o">.</span><span class="n">isStart</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">handleMoveStarted</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorOffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span> <span class="o">-</span> <span class="n">ev</span><span class="o">.</span><span class="n">buttonDownScenePos</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMoving</span><span class="p">:</span>  <span class="c1">## note: isMoving may become False in mid-drag due to right-click.</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorOffset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">modifiers</span><span class="p">(),</span> <span class="n">finish</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">movePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">KeyboardModifier</span><span class="p">(),</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">checkPointMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="c1">#print &quot;point moved; inform %d ROIs&quot; % len(self.roi)</span>
        <span class="c1"># A handle can be used by multiple ROIs; tell each to update its handle position</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rois</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">modifiers</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;scene&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">buildPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startAng</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sides</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sides</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
            <span class="n">ang</span> <span class="o">+=</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>            
            
    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="c1">### determine rotation of transform</span>
        <span class="c1">#m = self.sceneTransform()</span>
        <span class="c1">##mi = m.inverted()[0]</span>
        <span class="c1">#v = m.map(QtCore.QPointF(1, 0)) - m.map(QtCore.QPointF(0, 0))</span>
        <span class="c1">#va = np.arctan2(v.y(), v.x())</span>
        
        <span class="c1">### Determine length of unit vector in painter&#39;s coords</span>
        <span class="c1">##size = mi.map(Point(self.radius, self.radius)) - mi.map(Point(0, 0))</span>
        <span class="c1">##size = (size.x()*size.x() + size.y() * size.y()) ** 0.5</span>
        <span class="c1">#size = self.radius</span>
        
        <span class="c1">#bounds = QtCore.QRectF(-size, -size, size*2, size*2)</span>
        <span class="c1">#if bounds != self.bounds:</span>
            <span class="c1">#self.bounds = bounds</span>
            <span class="c1">#self.prepareGeometryChange()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHints</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        
        <span class="c1">#p.rotate(va * 180. / 3.1415926)</span>
        <span class="c1">#p.drawPath(self.path)        </span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>
        <span class="c1">#ang = self.startAng + va</span>
        <span class="c1">#dt = 2*np.pi / self.sides</span>
        <span class="c1">#for i in range(0, self.sides):</span>
            <span class="c1">#x1 = size * cos(ang)</span>
            <span class="c1">#y1 = size * sin(ang)</span>
            <span class="c1">#x2 = size * cos(ang+dt)</span>
            <span class="c1">#y2 = size * sin(ang+dt)</span>
            <span class="c1">#ang += dt</span>
            <span class="c1">#p.drawLine(Point(x1, y1), Point(x2, y2))</span>
            
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generateShape</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">s</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span>  <span class="c1">## beware--this can cause the view to adjust, which would immediately invalidate the shape.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span>
    
    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#print &#39;roi:&#39;, self.roi</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span>
        <span class="c1">#print &quot;   s1:&quot;, s1</span>
        <span class="c1">#s2 = self.shape()</span>
        <span class="c1">#print &quot;   s2:&quot;, s2</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">generateShape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## determine rotation of transform</span>
        <span class="c1">#m = self.sceneTransform()  ## Qt bug: do not access sceneTransform() until we know this object has a scene.</span>
        <span class="c1">#mi = m.inverted()[0]</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviceTransform</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
            <span class="k">return</span> <span class="kc">None</span>
        
        <span class="n">v</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">va</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">())</span>
        
        <span class="n">dti</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">invertQTransform</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="n">devPos</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QTransform</span><span class="p">()</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">devPos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">devPos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">va</span> <span class="o">*</span> <span class="mf">180.</span> <span class="o">/</span> <span class="mf">3.1415926</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">dti</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        
        
    <span class="k">def</span> <span class="nf">viewTransformChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">GraphicsObject</span><span class="o">.</span><span class="n">viewTransformChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1">## invalidate shape, recompute later if requested.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
    <span class="c1">#def itemChange(self, change, value):</span>
        <span class="c1">#if change == self.ItemScenePositionHasChanged:</span>
            <span class="c1">#self.updateShape()</span>


<div class="viewcode-block" id="TestROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.TestROI">[docs]</a><span class="k">class</span> <span class="nc">TestROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="c1">#QtGui.QGraphicsRectItem.__init__(self, pos[0], pos[1], size[0], size[1])</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="c1">#self.addTranslateHandle([0, 0])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addTranslateHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRotateHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRotateHandle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>



<div class="viewcode-block" id="RectROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.RectROI">[docs]</a><span class="k">class</span> <span class="nc">RectROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rectangular ROI subclass with a single scale handle at the top-right corner.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    pos            (length-2 sequence) The position of the ROI origin.</span>
<span class="sd">                   See ROI().</span>
<span class="sd">    size           (length-2 sequence) The size of the ROI. See ROI().</span>
<span class="sd">    centered       (bool) If True, scale handles affect the ROI relative to its</span>
<span class="sd">                   center, rather than its origin.</span>
<span class="sd">    sideScalers    (bool) If True, extra scale handles are added at the top and </span>
<span class="sd">                   right edges.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">centered</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sideScalers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="c1">#QtGui.QGraphicsRectItem.__init__(self, 0, 0, size[0], size[1])</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">centered</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            
        <span class="c1">#self.addTranslateHandle(center)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">center</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sideScalers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span></div>

<div class="viewcode-block" id="LineROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineROI">[docs]</a><span class="k">class</span> <span class="nc">LineROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rectangular ROI subclass with scale-rotate handles on either side. This</span>
<span class="sd">    allows the ROI to be positioned as if moving the ends of a line segment.</span>
<span class="sd">    A third handle controls the width of the ROI orthogonal to its &quot;line&quot; axis.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    pos1           (length-2 sequence) The position of the center of the ROI&#39;s</span>
<span class="sd">                   left edge.</span>
<span class="sd">    pos2           (length-2 sequence) The position of the center of the ROI&#39;s</span>
<span class="sd">                   right edge.</span>
<span class="sd">    width          (float) The width of the ROI.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">pos1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos1</span><span class="p">)</span>
        <span class="n">pos2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">pos2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pos2</span><span class="o">-</span><span class="n">pos1</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">ang</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ra</span><span class="p">),</span> <span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">ra</span><span class="p">))</span>
        <span class="n">pos1</span> <span class="o">=</span> <span class="n">pos1</span> <span class="o">+</span> <span class="n">c</span>
        
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">Point</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">angle</span><span class="o">=</span><span class="n">ang</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></div>
        

        
<div class="viewcode-block" id="MultiRectROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI">[docs]</a><span class="k">class</span> <span class="nc">MultiRectROI</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chain of rectangular ROIs connected by handles. </span>
<span class="sd">    </span>
<span class="sd">    This is generally used to mark a curved path through </span>
<span class="sd">    an image similarly to PolyLineROI. It differs in that each segment</span>
<span class="sd">    of the chain is rectangular instead of linear and thus has width.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    points         (list of length-2 sequences) The list of points in the path.</span>
<span class="sd">    width          (float) The width of the ROIs orthogonal to the path.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigRegionChangeFinished</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigRegionChangeStarted</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">sigRegionChanged</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">QtGui</span><span class="o">.</span><span class="n">QGraphicsObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen</span> <span class="o">=</span> <span class="n">pen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roiArgs</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Must start with at least 2 points&quot;</span><span class="p">)</span>
        
        <span class="c1">## create first segment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addSegment</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">connectTo</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scaleHandle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">## create remaining segments</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addSegment</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="MultiRectROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="MultiRectROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="MultiRectROI.roiChangedEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.roiChangedEvent">[docs]</a>    <span class="k">def</span> <span class="nf">roiChangedEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">==</span> <span class="n">w0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">l</span><span class="o">.</span><span class="n">scale</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">w</span><span class="o">/</span><span class="n">w0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="MultiRectROI.roiChangeStartedEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.roiChangeStartedEvent">[docs]</a>    <span class="k">def</span> <span class="nf">roiChangeStartedEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChangeStarted</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="MultiRectROI.roiChangeFinishedEvent"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.roiChangeFinishedEvent">[docs]</a>    <span class="k">def</span> <span class="nf">roiChangeFinishedEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChangeFinished</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="MultiRectROI.getHandlePositions"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.getHandlePositions">[docs]</a>    <span class="k">def</span> <span class="nf">getHandlePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the positions of all handles in local coordinates.&quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getHandles</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scenePos</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapFromScene</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">getHandles</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scenePos</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">pos</span></div>
        
<div class="viewcode-block" id="MultiRectROI.getArrayRegion"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.getArrayRegion">[docs]</a>    <span class="k">def</span> <span class="nf">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">rgns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">rgn</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">getArrayRegion</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rgn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
                <span class="c1">#return None</span>
            <span class="n">rgns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgn</span><span class="p">)</span>
            <span class="c1">#print l.state[&#39;size&#39;]</span>
            
        <span class="c1">## make sure orthogonal axis is the same size</span>
        <span class="c1">## (sometimes fp errors cause differences)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rgns</span><span class="p">])</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)]</span> <span class="o">*</span> <span class="n">rgns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">sl</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ms</span><span class="p">)</span>
        <span class="n">rgns</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="n">sl</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rgns</span><span class="p">]</span>
        <span class="c1">#print [r.shape for r in rgns], axes</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">rgns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="MultiRectROI.addSegment"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.addSegment">[docs]</a>    <span class="k">def</span> <span class="nf">addSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">scaleHandle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connectTo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new segment to the ROI connecting from the previous endpoint to *pos*.</span>
<span class="sd">        (pos is specified in the parent coordinate system of the MultiRectROI)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">## by default, connect to the previous endpoint</span>
        <span class="k">if</span> <span class="n">connectTo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">connectTo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getHandles</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="c1">## create new ROI</span>
        <span class="n">newRoi</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">roiArgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newRoi</span><span class="p">)</span>
        
        <span class="c1">## Add first SR handle</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">connectTo</span><span class="p">,</span> <span class="n">Handle</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">item</span><span class="o">=</span><span class="n">connectTo</span><span class="p">)</span>
            <span class="n">newRoi</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="n">connectTo</span><span class="p">,</span> <span class="n">connectTo</span><span class="o">.</span><span class="n">scenePos</span><span class="p">(),</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;scene&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="n">newRoi</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">connectTo</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;scene&#39;</span><span class="p">)</span>
            
        <span class="c1">## add second SR handle</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span> 
        <span class="n">newRoi</span><span class="o">.</span><span class="n">movePoint</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        
        <span class="c1">## optionally add scale handle (this MUST come after the two SR handles)</span>
        <span class="k">if</span> <span class="n">scaleHandle</span><span class="p">:</span>
            <span class="n">newRoi</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            
        <span class="n">newRoi</span><span class="o">.</span><span class="n">translatable</span> <span class="o">=</span> <span class="kc">False</span> 
        <span class="n">newRoi</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangedEvent</span><span class="p">)</span> 
        <span class="n">newRoi</span><span class="o">.</span><span class="n">sigRegionChangeStarted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangeStartedEvent</span><span class="p">)</span> 
        <span class="n">newRoi</span><span class="o">.</span><span class="n">sigRegionChangeFinished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangeFinishedEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> </div>
    

<div class="viewcode-block" id="MultiRectROI.removeSegment"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiRectROI.removeSegment">[docs]</a>    <span class="k">def</span> <span class="nf">removeSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Remove a segment from the ROI.&quot;&quot;&quot;</span>
        <span class="n">roi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
        <span class="n">roi</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangedEvent</span><span class="p">)</span> 
        <span class="n">roi</span><span class="o">.</span><span class="n">sigRegionChangeStarted</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangeStartedEvent</span><span class="p">)</span> 
        <span class="n">roi</span><span class="o">.</span><span class="n">sigRegionChangeFinished</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roiChangeFinishedEvent</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>
        
        
<div class="viewcode-block" id="MultiLineROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.MultiLineROI">[docs]</a><span class="k">class</span> <span class="nc">MultiLineROI</span><span class="p">(</span><span class="n">MultiRectROI</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">MultiRectROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: MultiLineROI has been renamed to MultiRectROI. (and MultiLineROI may be redefined in the future)&quot;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="EllipseROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.EllipseROI">[docs]</a><span class="k">class</span> <span class="nc">EllipseROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Elliptical ROI subclass with one scale handle and one rotation handle.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    pos            (length-2 sequence) The position of the ROI&#39;s origin.</span>
<span class="sd">    size           (length-2 sequence) The size of the ROI&#39;s bounding rectangle.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="c1">#QtGui.QGraphicsRectItem.__init__(self, 0, 0, size[0], size[1])</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRotateHandle</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">2.</span><span class="o">**-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="mf">2.</span><span class="o">**-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            
<div class="viewcode-block" id="EllipseROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.EllipseROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">height</span><span class="p">())</span><span class="c1">## workaround for GL bug</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">x</span><span class="p">()</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">y</span><span class="p">()</span><span class="o">/</span><span class="n">r</span><span class="o">.</span><span class="n">height</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">drawEllipse</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="EllipseROI.getArrayRegion"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.EllipseROI.getArrayRegion">[docs]</a>    <span class="k">def</span> <span class="nf">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the result of ROI.getArrayRegion() masked by the elliptical shape</span>
<span class="sd">        of the ROI. Regions outside the ellipse are set to 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">## generate an ellipsoidal mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">(((</span><span class="n">x</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span> <span class="p">((</span><span class="n">y</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    
        <span class="k">return</span> <span class="n">arr</span> <span class="o">*</span> <span class="n">mask</span></div>
    
<div class="viewcode-block" id="EllipseROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.EllipseROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">addEllipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span></div></div>
        
        
<div class="viewcode-block" id="CircleROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CircleROI">[docs]</a><span class="k">class</span> <span class="nc">CircleROI</span><span class="p">(</span><span class="n">EllipseROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Circular ROI subclass. Behaves exactly as EllipseROI, but may only be scaled</span>
<span class="sd">    proportionally to maintain its aspect ratio.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    pos            (length-2 sequence) The position of the ROI&#39;s origin.</span>
<span class="sd">    size           (length-2 sequence) The size of the ROI&#39;s bounding rectangle.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aspectLocked</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">#self.addTranslateHandle([0.5, 0.5])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleHandle</span><span class="p">([</span><span class="mf">0.5</span><span class="o">*</span><span class="mf">2.</span><span class="o">**-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="mf">2.</span><span class="o">**-</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></div>


<div class="viewcode-block" id="PolygonROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI">[docs]</a><span class="k">class</span> <span class="nc">PolygonROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="c1">## deprecated. Use PloyLineROI instead.</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="c1">#ROI.__init__(self, positions[0])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addFreeHandle</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: PolygonROI is deprecated. Use PolyLineROI instead.&quot;</span><span class="p">)</span>
        
            
<div class="viewcode-block" id="PolygonROI.listPoints"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI.listPoints">[docs]</a>    <span class="k">def</span> <span class="nf">listPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">]</span></div>
            
    <span class="c1">#def movePoint(self, *args, **kargs):</span>
        <span class="c1">#ROI.movePoint(self, *args, **kargs)</span>
        <span class="c1">#self.prepareGeometryChange()</span>
        <span class="c1">#for h in self.handles:</span>
            <span class="c1">#h[&#39;pos&#39;] = h[&#39;item&#39;].pos()</span>
            
<div class="viewcode-block" id="PolygonROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)):</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="PolygonROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromItem</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span>   <span class="c1">## |= gives the union of the two QRectFs</span>
        <span class="k">return</span> <span class="n">r</span></div>
    
<div class="viewcode-block" id="PolygonROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">p</span></div>
    
<div class="viewcode-block" id="PolygonROI.stateCopy"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolygonROI.stateCopy">[docs]</a>    <span class="k">def</span> <span class="nf">stateCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span>
        <span class="n">sc</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="c1">#sc[&#39;handles&#39;] = self.handles</span>
        <span class="k">return</span> <span class="n">sc</span></div></div>

<div class="viewcode-block" id="PolyLineROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI">[docs]</a><span class="k">class</span> <span class="nc">PolyLineROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container class for multiple connected LineSegmentROIs.</span>
<span class="sd">    </span>
<span class="sd">    This class allows the user to draw paths of multiple line segments.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    positions      (list of length-2 sequences) The list of points in the path.</span>
<span class="sd">                   Note that, unlike the handle positions specified in other</span>
<span class="sd">                   ROIs, these positions must be expressed in the normal</span>
<span class="sd">                   coordinate system of the ROI, rather than (0 to 1) relative</span>
<span class="sd">                   to the size of the ROI.</span>
<span class="sd">    closed         (bool) if True, an extra LineSegmentROI is added connecting </span>
<span class="sd">                   the beginning and end points.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="n">closed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="c1">#for p in positions:</span>
            <span class="c1">#self.addFreeHandle(p)</span>
         
        <span class="c1">#start = -1 if self.closed else 0</span>
        <span class="c1">#for i in range(start, len(self.handles)-1):</span>
            <span class="c1">#self.addSegment(self.handles[i][&#39;item&#39;], self.handles[i+1][&#39;item&#39;])</span>

<div class="viewcode-block" id="PolyLineROI.setPoints"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.setPoints">[docs]</a>    <span class="k">def</span> <span class="nf">setPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the complete sequence of points displayed by this ROI.</span>
<span class="sd">        </span>
<span class="sd">        ============= =========================================================</span>
<span class="sd">        **Arguments**</span>
<span class="sd">        points        List of (x,y) tuples specifying handle locations to set.</span>
<span class="sd">        closed        If bool, then this will set whether the ROI is closed </span>
<span class="sd">                      (the last point is connected to the first point). If</span>
<span class="sd">                      None, then the closed mode is left unchanged.</span>
<span class="sd">        ============= =========================================================</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">closed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="n">closed</span>
        
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addFreeHandle</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        
        <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addSegment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">])</span></div>
        
        
<div class="viewcode-block" id="PolyLineROI.clearPoints"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.clearPoints">[docs]</a>    <span class="k">def</span> <span class="nf">clearPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all handles and segments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="PolyLineROI.saveState"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.saveState">[docs]</a>    <span class="k">def</span> <span class="nf">saveState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">saveState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHandles</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">state</span></div>

<div class="viewcode-block" id="PolyLineROI.setState"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.setState">[docs]</a>    <span class="k">def</span> <span class="nf">setState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">ROI</span><span class="o">.</span><span class="n">setState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearPoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setPoints</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;points&#39;</span><span class="p">],</span> <span class="n">closed</span><span class="o">=</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;closed&#39;</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="PolyLineROI.addSegment"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.addSegment">[docs]</a>    <span class="k">def</span> <span class="nf">addSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">seg</span> <span class="o">=</span> <span class="n">LineSegmentROI</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">),</span> <span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">movable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">seg</span><span class="p">)</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">sigClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentClicked</span><span class="p">)</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">setZValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zValue</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span>
            <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setDeletable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setAcceptedMouseButtons</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">acceptedMouseButtons</span><span class="p">()</span> <span class="o">|</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">)</span> <span class="c1">## have these handles take left clicks too, so that handles cannot be added on top of other handles</span></div>
        
<div class="viewcode-block" id="PolyLineROI.setMouseHover"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.setMouseHover">[docs]</a>    <span class="k">def</span> <span class="nf">setMouseHover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hover</span><span class="p">):</span>
        <span class="c1">## Inform all the ROI&#39;s segments that the mouse is(not) hovering over it</span>
        <span class="n">ROI</span><span class="o">.</span><span class="n">setMouseHover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hover</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">setMouseHover</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span></div>
          
<div class="viewcode-block" id="PolyLineROI.addHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.addHandle">[docs]</a>    <span class="k">def</span> <span class="nf">addHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">addHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">sigRemoveRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span></div>
        
<div class="viewcode-block" id="PolyLineROI.segmentClicked"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.segmentClicked">[docs]</a>    <span class="k">def</span> <span class="nf">segmentClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="n">ev</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="c1">## pos should be in this item&#39;s coordinate system</span>
        <span class="k">if</span> <span class="n">ev</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">mapToParent</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">pos</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Either an event or a position must be given.&quot;</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">segment</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
        
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addFreeHandle</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexOfHandle</span><span class="p">(</span><span class="n">h2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addSegment</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">segment</span><span class="o">.</span><span class="n">replaceHandle</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="n">h3</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="PolyLineROI.removeHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.removeHandle">[docs]</a>    <span class="k">def</span> <span class="nf">removeHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">updateSegments</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ROI</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">)</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">sigRemoveRequested</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">updateSegments</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">rois</span><span class="p">[:]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeSegment</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">handles</span><span class="p">]</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            <span class="n">segments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replaceHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeSegment</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="PolyLineROI.removeSegment"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.removeSegment">[docs]</a>    <span class="k">def</span> <span class="nf">removeSegment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">handle</span> <span class="ow">in</span> <span class="n">seg</span><span class="o">.</span><span class="n">handles</span><span class="p">[:]:</span>
            <span class="n">seg</span><span class="o">.</span><span class="n">removeHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
        <span class="n">seg</span><span class="o">.</span><span class="n">sigClicked</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentClicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="PolyLineROI.checkRemoveHandle"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.checkRemoveHandle">[docs]</a>    <span class="k">def</span> <span class="nf">checkRemoveHandle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="c1">## called when a handle is about to display its context menu</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span></div>
        
<div class="viewcode-block" id="PolyLineROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1">#for s in self.segments:</span>
            <span class="c1">#s.update()</span>
        <span class="c1">#p.setPen(self.currentPen)</span>
        <span class="c1">#p.setPen(fn.mkPen(&#39;w&#39;))</span>
        <span class="c1">#p.drawRect(self.boundingRect())</span>
        <span class="c1">#p.drawPath(self.shape())</span>
        <span class="k">pass</span></div>
    
<div class="viewcode-block" id="PolyLineROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>
        <span class="c1">#r = QtCore.QRectF()</span>
        <span class="c1">#for h in self.handles:</span>
            <span class="c1">#r |= self.mapFromItem(h[&#39;item&#39;], h[&#39;item&#39;].boundingRect()).boundingRect()   ## |= gives the union of the two QRectFs</span>
        <span class="c1">#return r </span>

<div class="viewcode-block" id="PolyLineROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="n">p</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)):</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">p</span>        </div>

<div class="viewcode-block" id="PolyLineROI.getArrayRegion"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.getArrayRegion">[docs]</a>    <span class="k">def</span> <span class="nf">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">returnMappedCoords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the result of ROI.getArrayRegion(), masked by the shape of the </span>
<span class="sd">        ROI. Values outside the ROI shape are set to 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getArraySlice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">sl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">sliced</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="p">(</span><span class="n">sliced</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">sliced</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QImage</span><span class="o">.</span><span class="n">Format_ARGB32</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">mkPen</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">mkBrush</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setTransform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemTransform</span><span class="p">(</span><span class="n">img</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapRectToItem</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">bounds</span><span class="o">.</span><span class="n">left</span><span class="p">(),</span> <span class="o">-</span><span class="n">bounds</span><span class="o">.</span><span class="n">top</span><span class="p">())</span> 
        <span class="n">p</span><span class="o">.</span><span class="n">drawPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">imageToArray</span><span class="p">(</span><span class="n">im</span><span class="p">)[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sliced</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sliced</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">sliced</span> <span class="o">*</span> <span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="PolyLineROI.setPen"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.PolyLineROI.setPen">[docs]</a>    <span class="k">def</span> <span class="nf">setPen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">ROI</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">segments</span><span class="p">:</span>
            <span class="n">seg</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="LineSegmentROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI">[docs]</a><span class="k">class</span> <span class="nc">LineSegmentROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ROI subclass with two freely-moving handles defining a line.</span>
<span class="sd">    </span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    **Arguments**</span>
<span class="sd">    positions      (list of two length-2 sequences) The endpoints of the line </span>
<span class="sd">                   segment. Note that, unlike the handle positions specified in </span>
<span class="sd">                   other ROIs, these positions must be expressed in the normal</span>
<span class="sd">                   coordinate system of the ROI, rather than (0 to 1) relative</span>
<span class="sd">                   to the size of the ROI.</span>
<span class="sd">    \**args        All extra keyword arguments are passed to ROI()</span>
<span class="sd">    ============== =============================================================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">handles</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="c1">#ROI.__init__(self, positions[0])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;LineSegmentROI must be defined by exactly 2 positions. For more points, use PolyLineROI.&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">positions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addFreeHandle</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                
        
<div class="viewcode-block" id="LineSegmentROI.listPoints"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI.listPoints">[docs]</a>    <span class="k">def</span> <span class="nf">listPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">]</span></div>
            
<div class="viewcode-block" id="LineSegmentROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="LineSegmentROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="LineSegmentROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
    
        <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">h2</span><span class="o">-</span><span class="n">h1</span>
        <span class="k">if</span> <span class="n">dh</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="n">pxv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pixelVectors</span><span class="p">(</span><span class="n">dh</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pxv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
            
        <span class="n">pxv</span> <span class="o">*=</span> <span class="mi">4</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">pxv</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">h2</span><span class="o">+</span><span class="n">pxv</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">h2</span><span class="o">-</span><span class="n">pxv</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">h1</span><span class="o">-</span><span class="n">pxv</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">h1</span><span class="o">+</span><span class="n">pxv</span><span class="p">)</span>
      
        <span class="k">return</span> <span class="n">p</span></div>
    
<div class="viewcode-block" id="LineSegmentROI.getArrayRegion"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.LineSegmentROI.getArrayRegion">[docs]</a>    <span class="k">def</span> <span class="nf">getArrayRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use the position of this ROI relative to an imageItem to pull a slice </span>
<span class="sd">        from an array.</span>
<span class="sd">        </span>
<span class="sd">        Since this pulls 1D data from a 2D coordinate system, the return value </span>
<span class="sd">        will have ndim = data.ndim-1</span>
<span class="sd">        </span>
<span class="sd">        See ROI.getArrayRegion() for a description of the arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">imgPts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToItem</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">]</span>
        <span class="n">rgns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imgPts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">imgPts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">imgPts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">imgPts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">affineSlice</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">length</span><span class="p">()),),</span> <span class="n">vectors</span><span class="o">=</span><span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">norm</span><span class="p">())],</span> <span class="n">origin</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rgns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">rgns</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div></div>
        

<div class="viewcode-block" id="SpiralROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI">[docs]</a><span class="k">class</span> <span class="nc">SpiralROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100e-6</span><span class="p">,</span><span class="mf">100e-6</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translateSnap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addFreeHandle</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addRotateFreeHandle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1">#self.getRadius()</span>
        <span class="c1">#QtCore.connect(self, QtCore.SIGNAL(&#39;regionChanged&#39;), self.</span>
        
        
<div class="viewcode-block" id="SpiralROI.getRadius"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI.getRadius">[docs]</a>    <span class="k">def</span> <span class="nf">getRadius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
        <span class="c1">#r2 = radius[1]</span>
        <span class="c1">#r3 = r2[0]</span>
        <span class="k">return</span> <span class="n">radius</span></div>
    
<div class="viewcode-block" id="SpiralROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRadius</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QRectF</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.2</span><span class="o">*</span><span class="n">r</span><span class="p">)</span></div>
        <span class="c1">#return self.bounds</span>
    
    <span class="c1">#def movePoint(self, *args, **kargs):</span>
        <span class="c1">#ROI.movePoint(self, *args, **kargs)</span>
        <span class="c1">#self.prepareGeometryChange()</span>
        <span class="c1">#for h in self.handles:</span>
            <span class="c1">#h[&#39;pos&#39;] = h[&#39;item&#39;].pos()/self.state[&#39;size&#39;][0]</span>
            
<div class="viewcode-block" id="SpiralROI.stateChanged"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI.stateChanged">[docs]</a>    <span class="k">def</span> <span class="nf">stateChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">ROI</span><span class="o">.</span><span class="n">stateChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">finish</span><span class="o">=</span><span class="n">finish</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;item&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">h0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mf">30.0</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">360.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRadius</span><span class="p">()</span>
            <span class="n">theta</span> <span class="o">+=</span> <span class="mf">20.0</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">360.0</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">Point</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">radius</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QPointF</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">))</span>
                <span class="n">theta</span> <span class="o">+=</span> <span class="mf">20.0</span><span class="o">*</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">360.0</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">x1</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">y1</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
           
                
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span></div>
    
        
<div class="viewcode-block" id="SpiralROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">addEllipse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">p</span></div>
    
<div class="viewcode-block" id="SpiralROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.SpiralROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="c1">#path = self.shape()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPen</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">())</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPen</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">())</span></div></div>
        
    
<div class="viewcode-block" id="CrosshairROI"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CrosshairROI">[docs]</a><span class="k">class</span> <span class="nc">CrosshairROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A crosshair ROI whose position is at the center of the crosshairs. By default, it is scalable, rotatable and translatable.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#size = [100e-6,100e-6]</span>
            <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ROI</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">sigRegionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalidate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addScaleRotateHandle</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aspectLocked</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="CrosshairROI.invalidate"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CrosshairROI.invalidate">[docs]</a>    <span class="k">def</span> <span class="nf">invalidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareGeometryChange</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="CrosshairROI.boundingRect"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CrosshairROI.boundingRect">[docs]</a>    <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#size = self.size()</span>
        <span class="c1">#return QtCore.QRectF(-size[0]/2., -size[1]/2., size[0], size[1]).normalized()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">()</span></div>
    
    <span class="c1">#def getRect(self):</span>
        <span class="c1">### same as boundingRect -- for internal use so that boundingRect can be re-implemented in subclasses</span>
        <span class="c1">#size = self.size()</span>
        <span class="c1">#return QtCore.QRectF(-size[0]/2., -size[1]/2., size[0], size[1]).normalized()</span>
        
    
<div class="viewcode-block" id="CrosshairROI.shape"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CrosshairROI.shape">[docs]</a>    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPath</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">lineTo</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapToDevice</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">stroker</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPainterPathStroker</span><span class="p">()</span>
            <span class="n">stroker</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">outline</span> <span class="o">=</span> <span class="n">stroker</span><span class="o">.</span><span class="n">createStroke</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapFromDevice</span><span class="p">(</span><span class="n">outline</span><span class="p">)</span>
            
        
            <span class="c1">##h1 = self.handles[0][&#39;item&#39;].pos()</span>
            <span class="c1">##h2 = self.handles[1][&#39;item&#39;].pos()</span>
            <span class="c1">#w1 = Point(-0.5, 0)*self.size()</span>
            <span class="c1">#w2 = Point(0.5, 0)*self.size()</span>
            <span class="c1">#h1 = Point(0, -0.5)*self.size()</span>
            <span class="c1">#h2 = Point(0, 0.5)*self.size()</span>
            
            <span class="c1">#dh = h2-h1</span>
            <span class="c1">#dw = w2-w1</span>
            <span class="c1">#if dh.length() == 0 or dw.length() == 0:</span>
                <span class="c1">#return p</span>
            <span class="c1">#pxv = self.pixelVectors(dh)[1]</span>
            <span class="c1">#if pxv is None:</span>
                <span class="c1">#return p</span>
                
            <span class="c1">#pxv *= 4</span>
            
            <span class="c1">#p.moveTo(h1+pxv)</span>
            <span class="c1">#p.lineTo(h2+pxv)</span>
            <span class="c1">#p.lineTo(h2-pxv)</span>
            <span class="c1">#p.lineTo(h1-pxv)</span>
            <span class="c1">#p.lineTo(h1+pxv)</span>
            
            <span class="c1">#pxv = self.pixelVectors(dw)[1]</span>
            <span class="c1">#if pxv is None:</span>
                <span class="c1">#return p</span>
                
            <span class="c1">#pxv *= 4</span>
            
            <span class="c1">#p.moveTo(w1+pxv)</span>
            <span class="c1">#p.lineTo(w2+pxv)</span>
            <span class="c1">#p.lineTo(w2-pxv)</span>
            <span class="c1">#p.lineTo(w1-pxv)</span>
            <span class="c1">#p.lineTo(w1+pxv)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span></div>
    
<div class="viewcode-block" id="CrosshairROI.paint"><a class="viewcode-back" href="../../../../../../bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.html#bornagain.external.pyqtgraph.pyqtgraph.graphicsItems.ROI.CrosshairROI.paint">[docs]</a>    <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c1">#p.save()</span>
        <span class="c1">#r = self.getRect()</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getState</span><span class="p">()[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPainter</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentPen</span><span class="p">)</span>
        <span class="c1">#p.translate(r.left(), r.top())</span>
        <span class="c1">#p.scale(r.width()/10., r.height()/10.) ## need to scale up a little because drawLine has trouble dealing with 0.5</span>
        <span class="c1">#p.drawLine(0,5, 10,5)</span>
        <span class="c1">#p.drawLine(5,0, 5,10)</span>
        <span class="c1">#p.restore()</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div></div>
        
        
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Richard A Kirian.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>