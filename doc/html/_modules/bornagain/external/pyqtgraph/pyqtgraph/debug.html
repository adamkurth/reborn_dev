

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>bornagain.external.pyqtgraph.pyqtgraph.debug &mdash; bornagain 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="bornagain 0.0.1 documentation" href="../../../../../index.html"/>
        <link rel="up" title="bornagain.external.pyqtgraph.pyqtgraph" href="../pyqtgraph.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> bornagain
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bornagain.html">bornagain package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">bornagain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../coding.html">Coding guidlines for developers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">bornagain</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../pyqtgraph.html">bornagain.external.pyqtgraph.pyqtgraph</a> &raquo;</li>
        
      <li>bornagain.external.pyqtgraph.pyqtgraph.debug</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for bornagain.external.pyqtgraph.pyqtgraph.debug</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">debug.py - Functions to aid in debugging </span>
<span class="sd">Copyright 2010  Luke Campagnola</span>
<span class="sd">Distributed under MIT/X11 license. See license.txt for more infomation.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">gc</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">types</span><span class="o">,</span> <span class="nn">weakref</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">cProfile</span><span class="o">,</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">ptime</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="k">import</span> <span class="n">ndarray</span>
<span class="kn">from</span> <span class="nn">.Qt</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">.util.mutex</span> <span class="k">import</span> <span class="n">Mutex</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="k">import</span> <span class="n">cprint</span>

<span class="n">__ftraceDepth</span> <span class="o">=</span> <span class="mi">0</span>
<div class="viewcode-block" id="ftrace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ftrace">[docs]</a><span class="k">def</span> <span class="nf">ftrace</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator used for marking the beginning and end of function calls.</span>
<span class="sd">    Automatically indents nested calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">__ftraceDepth</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">__ftraceDepth</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pfx</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; start&quot;</span><span class="p">)</span>
        <span class="n">__ftraceDepth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">__ftraceDepth</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pfx</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; done&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rv</span>
    <span class="k">return</span> <span class="n">w</span></div>


<div class="viewcode-block" id="Tracer"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Tracer">[docs]</a><span class="k">class</span> <span class="nc">Tracer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints every function enter/exit. Useful for debugging crashes / lockups.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Tracer.trace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Tracer.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># If it has been a long time since we saw the top of the stack, </span>
        <span class="c1"># print a reminder</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----- current stack: -----&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&gt;&gt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameInfo</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> 
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;&lt; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameInfo</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span> 
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span></div>

<div class="viewcode-block" id="Tracer.stop"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Tracer.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tracer.start"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Tracer.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tracer.frameInfo"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Tracer.frameInfo">[docs]</a>    <span class="k">def</span> <span class="nf">frameInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fr</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_filename</span>
        <span class="n">funcname</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="n">lineno</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">f_lineno</span>
        <span class="n">callfr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">callline</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callfr</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span> <span class="n">callfr</span><span class="o">.</span><span class="n">f_lineno</span><span class="p">)</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">value_dict</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getargvalues</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="n">value_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">funcname</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">funcname</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callline</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">funcname</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="warnOnException"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.warnOnException">[docs]</a><span class="k">def</span> <span class="nf">warnOnException</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator which catches/ignores exceptions and prints a stack trace.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">printExc</span><span class="p">(</span><span class="s1">&#39;Ignored exception:&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w</span></div>

<div class="viewcode-block" id="getExc"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.getExc">[docs]</a><span class="k">def</span> <span class="nf">getExc</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;|  &#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">()[:</span><span class="o">-</span><span class="n">skip</span><span class="p">]</span> 
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;  ---- exception caught ----&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span> 
            <span class="o">+</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exception_only</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">lines2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">lines2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">lines3</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines2</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines3</span><span class="p">)</span></div>


<div class="viewcode-block" id="printExc"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.printExc">[docs]</a><span class="k">def</span> <span class="nf">printExc</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print an error message followed by an indented exception backtrace</span>
<span class="sd">    (This function is intended to be called within except: blocks)&quot;&quot;&quot;</span>
    <span class="n">exc</span> <span class="o">=</span> <span class="n">getExc</span><span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">),</span> <span class="n">msg</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="printTrace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.printTrace">[docs]</a><span class="k">def</span> <span class="nf">printTrace</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print an error message followed by an indented stack trace&quot;&quot;&quot;</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">backtrace</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#exc = getExc(indent, prefix + &#39;  &#39;)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]  </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">),</span> <span class="n">msg</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">trace</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="n">indent</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">30</span> <span class="o">+</span> <span class="s1">&#39;&lt;&lt;&#39;</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="backtrace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.backtrace">[docs]</a><span class="k">def</span> <span class="nf">backtrace</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">()[:</span><span class="o">-</span><span class="p">(</span><span class="n">skip</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>    </div>
    
    
<div class="viewcode-block" id="listObjs"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.listObjs">[docs]</a><span class="k">def</span> <span class="nf">listObjs</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List all objects managed by python gc with class name matching regex.</span>
<span class="sd">    Finds &#39;Q...&#39; classes by default.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_objects</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">typ</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_objects</span><span class="p">()</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)]</span></div>
        

    
<div class="viewcode-block" id="findRefPath"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.findRefPath">[docs]</a><span class="k">def</span> <span class="nf">findRefPath</span><span class="p">(</span><span class="n">startObj</span><span class="p">,</span> <span class="n">endObj</span><span class="p">,</span> <span class="n">maxLen</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">restart</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seen</span><span class="o">=</span><span class="p">{},</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine all paths of object references from startObj to endObj&quot;&quot;&quot;</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">endObj</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ignore</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">())]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">seen</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">8</span><span class="o">-</span><span class="n">maxLen</span><span class="p">)</span>
    <span class="c1">#print prefix + str(map(type, path))</span>
    <span class="n">prefix</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
    <span class="k">if</span> <span class="n">restart</span><span class="p">:</span>
        <span class="c1">#gc.collect()</span>
        <span class="n">seen</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">newRefs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">endObj</span><span class="p">)</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">]</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">newRefs</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#fo = allFrameObjs()</span>
    <span class="c1">#newRefs = []</span>
    <span class="c1">#for r in gc.get_referrers(endObj):</span>
        <span class="c1">#try:</span>
            <span class="c1">#if r not in fo:</span>
                <span class="c1">#newRefs.append(r)</span>
        <span class="c1">#except:</span>
            <span class="c1">#newRefs.append(r)            </span>
        
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">newRefs</span><span class="p">:</span>
        <span class="c1">#print prefix+&quot;-&gt;&quot;+str(type(r))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;frame&#39;</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;listiterator&#39;</span><span class="p">]:</span>
            <span class="c1">#print prefix+&quot;  FRAME&quot;</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">r</span> <span class="ow">is</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">path</span><span class="p">]):</span>
                <span class="c1">#print prefix+&quot;  LOOP&quot;, objChainString([r]+path)</span>
                <span class="k">continue</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="n">startObj</span><span class="p">:</span>
            <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">r</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">refPathString</span><span class="p">([</span><span class="n">startObj</span><span class="p">]</span><span class="o">+</span><span class="n">path</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">maxLen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print prefix+&quot;  END:&quot;, objChainString([r]+path)</span>
            <span class="k">continue</span>
        <span class="c1">## See if we have already searched this node.</span>
        <span class="c1">## If not, recurse.</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache</span> <span class="o">=</span> <span class="n">seen</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">cache</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">maxLen</span><span class="p">:</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">refPathString</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">path</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">tree</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">findRefPath</span><span class="p">(</span><span class="n">startObj</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">maxLen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">restart</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">+</span><span class="n">path</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore</span><span class="p">)</span>
            <span class="n">seen</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLen</span><span class="p">,</span> <span class="n">tree</span><span class="p">]</span>
        <span class="c1">## integrate any returned results</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print prefix+&quot;  EMPTY TREE&quot;</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                <span class="n">refs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="c1">#seen[id(r)] = [maxLen, refs]</span>
    <span class="k">return</span> <span class="n">refs</span></div>


<div class="viewcode-block" id="objString"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.objString">[docs]</a><span class="k">def</span> <span class="nf">objString</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a short but descriptive string for any object&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;dict {</span><span class="si">%s</span><span class="s2">,...}&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;dict {</span><span class="si">%s</span><span class="s2">}&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">...&quot;&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj</span><span class="p">[:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;ndarray </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">,...]&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> [</span><span class="si">%s</span><span class="s2">]&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span></div>

<div class="viewcode-block" id="refPathString"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.refPathString">[docs]</a><span class="k">def</span> <span class="nf">refPathString</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a list of adjacent objects in a reference path, print the &#39;natural&#39; path</span>
<span class="sd">    names (ie, attribute names, keys, and indexes) that follow from one object to the next .&quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">objString</span><span class="p">(</span><span class="n">chain</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1">#print &quot; -&gt; &quot;, i</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">o1</span> <span class="o">=</span> <span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">o2</span> <span class="o">=</span> <span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">cont</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">o2</span> <span class="ow">is</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">o1</span><span class="p">]):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;[</span><span class="si">%d</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">o1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o2</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="c1">#print &quot;  not list&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="s1">&#39;__dict__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o2</span> <span class="o">==</span> <span class="n">o1</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;.__dict__&quot;</span>
                <span class="k">continue</span>
            <span class="n">o3</span> <span class="o">=</span> <span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">o2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="n">o3</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span>
                    <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
        <span class="c1">#print &quot;  not __dict__&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o2</span> <span class="ow">in</span> <span class="n">o1</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;[key:</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">objString</span><span class="p">(</span><span class="n">o2</span><span class="p">)</span>
                    <span class="k">continue</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">o1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="n">o2</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">objString</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">cont</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
        <span class="c1">#print &quot;  not dict&quot;</span>
        <span class="c1">#for k in dir(o1):  ## Not safe to request attributes like this.</span>
            <span class="c1">#if getattr(o1, k) is o2:</span>
                <span class="c1">#s += &quot;.%s&quot; % k</span>
                <span class="c1">#cont = True</span>
                <span class="c1">#continue</span>
        <span class="c1">#print &quot;  not attr&quot;</span>
        <span class="k">if</span> <span class="n">cont</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot; ? &quot;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">s</span></div>

    
<div class="viewcode-block" id="objectSize"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.objectSize">[docs]</a><span class="k">def</span> <span class="nf">objectSize</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Guess how much memory an object is using&quot;&quot;&quot;</span>
    <span class="n">ignoreTypes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MethodType&#39;</span><span class="p">,</span> <span class="s1">&#39;UnboundMethodType&#39;</span><span class="p">,</span> <span class="s1">&#39;BuiltinMethodType&#39;</span><span class="p">,</span> <span class="s1">&#39;FunctionType&#39;</span><span class="p">,</span> <span class="s1">&#39;BuiltinFunctionType&#39;</span><span class="p">]</span>
    <span class="n">ignoreTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ignoreTypes</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span>
    <span class="n">ignoreRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(method-wrapper|Flag|ItemChange|Option|Mode)&#39;</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">ignore</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="o">*</span><span class="n">depth</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">hash</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">hsh</span> <span class="o">=</span> <span class="n">obj</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">hsh</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)),</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        
    <span class="k">if</span> <span class="n">hsh</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">ignore</span><span class="p">[</span><span class="n">hsh</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
            
        
    <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s2">&quot;list:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">objectSize</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39;  +&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s2">&quot;list:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">objectSize</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39;  +&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">s</span>
        <span class="c1">#elif isinstance(obj, QtCore.QObject):</span>
            <span class="c1">#try:</span>
                <span class="c1">#childs = obj.children()</span>
                <span class="c1">#if verbose:</span>
                    <span class="c1">#print indent+&quot;Qt children:&quot;</span>
                <span class="c1">#for ch in childs:</span>
                    <span class="c1">#s = objectSize(obj, ignore=ignore, verbose=verbose, depth=depth+1)</span>
                    <span class="c1">#size += s</span>
                    <span class="c1">#if verbose:</span>
                        <span class="c1">#print indent + &#39;  +&#39;, ch.objectName(), s</span>
                    
            <span class="c1">#except:</span>
                <span class="c1">#pass</span>
    <span class="c1">#if isinstance(obj, types.InstanceType):</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">indent</span><span class="o">+</span><span class="s1">&#39;attrs:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;__dict__&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ignoreTypes</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">strtyp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ignoreRegex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">strtyp</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1">#if isinstance(o, types.ObjectType) and strtyp == &quot;&lt;type &#39;method-wrapper&#39;&gt;&quot;:</span>
                <span class="c1">#continue</span>
            
            <span class="c1">#if verbose:</span>
                <span class="c1">#print indent, k, &#39;?&#39;</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">!=</span> <span class="n">types</span><span class="o">.</span><span class="n">FrameType</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">objectSize</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="n">ignore</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">+=</span> <span class="n">s</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;  +&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="c1">#else:</span>
                <span class="c1">#if verbose:</span>
                    <span class="c1">#print indent + &#39;  -&#39;, k, len(refs)</span>
    <span class="k">return</span> <span class="n">size</span></div>

<div class="viewcode-block" id="GarbageWatcher"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.GarbageWatcher">[docs]</a><span class="k">class</span> <span class="nc">GarbageWatcher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenient dictionary for holding weak references to objects.</span>
<span class="sd">    Mainly used to check whether the objects have been collect yet or not.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        gw = GarbageWatcher()</span>
<span class="sd">        gw[&#39;objName&#39;] = obj</span>
<span class="sd">        gw[&#39;objName2&#39;] = obj2</span>
<span class="sd">        gw.check()  </span>
<span class="sd">        </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objs</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allNames</span> <span class="o">=</span> <span class="p">[]</span>
        
<div class="viewcode-block" id="GarbageWatcher.add"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.GarbageWatcher.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        
<div class="viewcode-block" id="GarbageWatcher.check"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.GarbageWatcher.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print a list of all watched objects and whether they have been collected.&quot;&quot;&quot;</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">dead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allNames</span><span class="p">[:]</span>
        <span class="n">alive</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">:</span>
            <span class="n">dead</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">alive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleted objects:&quot;</span><span class="p">,</span> <span class="n">dead</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Live objects:&quot;</span><span class="p">,</span> <span class="n">alive</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span></div>

    


<div class="viewcode-block" id="Profiler"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler">[docs]</a><span class="k">class</span> <span class="nc">Profiler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple profiler allowing measurement of multiple time intervals.</span>

<span class="sd">    By default, profilers are disabled.  To enable profiling, set the</span>
<span class="sd">    environment variable `PYQTGRAPHPROFILE` to a comma-separated list of</span>
<span class="sd">    fully-qualified names of profiled functions.</span>

<span class="sd">    Calling a profiler registers a message (defaulting to an increasing</span>
<span class="sd">    counter) that contains the time elapsed since the last call.  When the</span>
<span class="sd">    profiler is about to be garbage-collected, the messages are passed to the</span>
<span class="sd">    outer profiler if one is running, or printed to stdout otherwise.</span>

<span class="sd">    If `delayed` is set to False, messages are immediately printed instead.</span>

<span class="sd">    Example:</span>
<span class="sd">        def function(...):</span>
<span class="sd">            profiler = Profiler()</span>
<span class="sd">            ... do stuff ...</span>
<span class="sd">            profiler(&#39;did stuff&#39;)</span>
<span class="sd">            ... do other stuff ...</span>
<span class="sd">            profiler(&#39;did other stuff&#39;)</span>
<span class="sd">            # profiler is garbage-collected and flushed at function end</span>

<span class="sd">    If this function is a method of class C, setting `PYQTGRAPHPROFILE` to</span>
<span class="sd">    &quot;C.function&quot; (without the module name) will enable this profiler.</span>

<span class="sd">    For regular functions, use the qualified name of the function, stripping</span>
<span class="sd">    only the initial &quot;pyqtgraph.&quot; prefix from the module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_profilers</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYQTGRAPHPROFILE&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">_profilers</span> <span class="o">=</span> <span class="n">_profilers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">_profilers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    
    <span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_msgs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">disable</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set this flag to disable all or individual profilers at runtime</span>
    
<div class="viewcode-block" id="Profiler.DisabledProfiler"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.DisabledProfiler">[docs]</a>    <span class="k">class</span> <span class="nc">DisabledProfiler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="k">pass</span>
<div class="viewcode-block" id="Profiler.DisabledProfiler.finish"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.DisabledProfiler.finish">[docs]</a>        <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">pass</span></div>
<div class="viewcode-block" id="Profiler.DisabledProfiler.mark"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.DisabledProfiler.mark">[docs]</a>        <span class="k">def</span> <span class="nf">mark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">pass</span></div></div>
    <span class="n">_disabledProfiler</span> <span class="o">=</span> <span class="n">DisabledProfiler</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="n">delayed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Optionally create a new profiler based on caller&#39;s qualname.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">disabled</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="p">(</span><span class="n">disabled</span> <span class="o">==</span> <span class="s1">&#39;env&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_profilers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_disabledProfiler</span>
                        
        <span class="c1"># determine the qualified name of the caller function</span>
        <span class="n">caller_frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">caller_object_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">caller_frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s2">&quot;self&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c1"># we are in a regular function</span>
            <span class="n">qualifier</span> <span class="o">=</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="s2">&quot;__name__&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># we are in a method</span>
            <span class="n">qualifier</span> <span class="o">=</span> <span class="n">caller_object_type</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">func_qualname</span> <span class="o">=</span> <span class="n">qualifier</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">caller_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="k">if</span> <span class="n">disabled</span> <span class="o">==</span> <span class="s1">&#39;env&#39;</span> <span class="ow">and</span> <span class="n">func_qualname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_profilers</span><span class="p">:</span> <span class="c1"># don&#39;t do anything</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_disabledProfiler</span>
        <span class="c1"># create an actual profiling object</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Profiler</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">msg</span> <span class="ow">or</span> <span class="n">func_qualname</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_delayed</span> <span class="o">=</span> <span class="n">delayed</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_markCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_firstTime</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_lastTime</span> <span class="o">=</span> <span class="n">ptime</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_newMsg</span><span class="p">(</span><span class="s2">&quot;&gt; Entering &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register or print a new message with timing information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_markCount</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">newTime</span> <span class="o">=</span> <span class="n">ptime</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_newMsg</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">: </span><span class="si">%0.4f</span><span class="s2"> ms&quot;</span><span class="p">,</span> 
                     <span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="n">newTime</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastTime</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastTime</span> <span class="o">=</span> <span class="n">newTime</span>
        
<div class="viewcode-block" id="Profiler.mark"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.mark">[docs]</a>    <span class="k">def</span> <span class="nf">mark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_newMsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">msg</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delayed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
    
<div class="viewcode-block" id="Profiler.finish"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.finish">[docs]</a>    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a final message; flush the message list if no parent profiler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable</span><span class="p">:</span>
            <span class="k">return</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_newMsg</span><span class="p">(</span><span class="s2">&quot;&lt; Exiting </span><span class="si">%s</span><span class="s2">, total time: </span><span class="si">%0.4f</span><span class="s2"> ms&quot;</span><span class="p">,</span> 
                     <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="p">(</span><span class="n">ptime</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstTime</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_depth</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Profiler.flush"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.Profiler.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">]))</span>
            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_msgs</span> <span class="o">=</span> <span class="p">[]</span></div></div>


<div class="viewcode-block" id="profile"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.profile">[docs]</a><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profile_run&#39;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s1">&#39;cumulative&#39;</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Common-use for cProfile&quot;&quot;&quot;</span>
    <span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stats</span></div>
        
        
  
<span class="c1">#### Code for listing (nearly) all objects in the known universe</span>
<span class="c1">#### http://utcc.utoronto.ca/~cks/space/blog/python/GetAllObjects</span>
<span class="c1"># Recursively expand slist&#39;s objects</span>
<span class="c1"># into olist, using seen to track</span>
<span class="c1"># already processed objects.</span>
<span class="k">def</span> <span class="nf">_getr</span><span class="p">(</span><span class="n">slist</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">slist</span><span class="p">:</span>
        
        <span class="n">oid</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">olist</span> <span class="ow">or</span> <span class="n">typ</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>    <span class="c1">## or e in olist:     ## since we&#39;re excluding all ints, there is no longer a need to check for olist keys</span>
            <span class="k">continue</span>
        <span class="n">olist</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">if</span> <span class="n">first</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">1000</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">tl</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referents</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tl</span><span class="p">:</span>
            <span class="n">_getr</span><span class="p">(</span><span class="n">tl</span><span class="p">,</span> <span class="n">olist</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>        
<span class="c1"># The public function.</span>
<div class="viewcode-block" id="get_all_objects"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.get_all_objects">[docs]</a><span class="k">def</span> <span class="nf">get_all_objects</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return a list of all live Python objects (excluding int and long), not including the list itself.&quot;&quot;&quot;</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">gcl</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_objects</span><span class="p">()</span>
    <span class="n">olist</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_getr</span><span class="p">(</span><span class="n">gcl</span><span class="p">,</span> <span class="n">olist</span><span class="p">)</span>
    
    <span class="k">del</span> <span class="n">olist</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">olist</span><span class="p">)]</span>
    <span class="k">del</span> <span class="n">olist</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">gcl</span><span class="p">)]</span>
    <span class="k">del</span> <span class="n">olist</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">())]</span>
    <span class="k">return</span> <span class="n">olist</span></div>


<div class="viewcode-block" id="lookup"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.lookup">[docs]</a><span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return an object given its ID, if it exists.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">objects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">objects</span> <span class="o">=</span> <span class="n">get_all_objects</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">objects</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span></div>
        
        
                    
        
<div class="viewcode-block" id="ObjTracker"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker">[docs]</a><span class="k">class</span> <span class="nc">ObjTracker</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tracks all objects under the sun, reporting the changes between snapshots: what objects are created, deleted, and persistent.</span>
<span class="sd">    This class is very useful for tracking memory leaks. The class goes to great (but not heroic) lengths to avoid tracking </span>
<span class="sd">    its own internal objects.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        ot = ObjTracker()   # takes snapshot of currently existing objects</span>
<span class="sd">           ... do stuff ...</span>
<span class="sd">        ot.diff()           # prints lists of objects created and deleted since ot was initialized</span>
<span class="sd">           ... do stuff ...</span>
<span class="sd">        ot.diff()           # prints lists of objects created and deleted since last call to ot.diff()</span>
<span class="sd">                            # also prints list of items that were created since initialization AND have not been deleted yet</span>
<span class="sd">                            #   (if done correctly, this list can tell you about objects that were leaked)</span>
<span class="sd">           </span>
<span class="sd">        arrays = ot.findPersistent(&#39;ndarray&#39;)  ## returns all objects matching &#39;ndarray&#39; (string match, not instance checking)</span>
<span class="sd">                                               ## that were considered persistent when the last diff() was run</span>
<span class="sd">                                               </span>
<span class="sd">        describeObj(arrays[0])    ## See if we can determine who has references to this array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="n">allObjs</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">## keep track of all objects created and stored within class instances</span>
    <span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">allObjs</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span> <span class="o">=</span> <span class="p">{}</span>        <span class="c1">## list of objects that exist when the tracker is initialized {oid: weakref}</span>
                                   <span class="c1">##   (If it is not possible to weakref the object, then the value is None)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span> <span class="o">=</span> <span class="p">{}</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1">## list of objects that have been created since initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">## list of objects considered &#39;persistent&#39; when the last diff() was called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objTypes</span> <span class="o">=</span> <span class="p">{}</span>
            
        <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objTypes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">:</span>
            <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<div class="viewcode-block" id="ObjTracker.findNew"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.findNew">[docs]</a>    <span class="k">def</span> <span class="nf">findNew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all objects matching regex that were considered &#39;new&#39; when the last diff() was run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findTypes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ObjTracker.findPersistent"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.findPersistent">[docs]</a>    <span class="k">def</span> <span class="nf">findPersistent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return all objects matching regex that were considered &#39;persistent&#39; when the last diff() was run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findTypes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span></div>
        
    
<div class="viewcode-block" id="ObjTracker.start"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remember the current set of objects as the comparison for all future calls to diff()</span>
<span class="sd">        Called automatically on init, but can be called manually as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">refs</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forgetRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">refs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rememberRef</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">count</span><span class="p">)</span></div>
        <span class="c1">#self.newRefs.clear()</span>
        <span class="c1">#self.newRefs.update(refs)</span>

<div class="viewcode-block" id="ObjTracker.diff"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute all differences between the current object set and the reference set.</span>
<span class="sd">        Print a set of reports for created, deleted, and persistent objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">refs</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>   <span class="c1">## refs contains the list of ALL objects</span>
        
        <span class="c1">## Which refs have disappeared since call to start()  (these are only displayed once, then forgotten.)</span>
        <span class="n">delRefs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
                <span class="n">delRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forgetRef</span><span class="p">(</span><span class="n">delRefs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
                <span class="n">delRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">forgetRef</span><span class="p">(</span><span class="n">delRefs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1">#print &quot;deleted:&quot;, len(delRefs)</span>
                
        <span class="c1">## Which refs have appeared since call to start() or diff()</span>
        <span class="n">persistentRefs</span> <span class="o">=</span> <span class="p">{}</span>      <span class="c1">## created since start(), but before last diff()</span>
        <span class="n">createRefs</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1">## created since last diff()</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="p">:</span>       
                <span class="k">if</span> <span class="n">o</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">:</span>     
                    <span class="n">createRefs</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>          <span class="c1">## object has been created since last diff()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">persistentRefs</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>      <span class="c1">## object has been created since start(), but before last diff() (persistent)</span>
        <span class="c1">#print &quot;new:&quot;, len(newRefs)</span>
                
        <span class="c1">## self.newRefs holds the entire set of objects created since start()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forgetRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">persistentRefs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">createRefs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rememberRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="c1">#print &quot;created:&quot;, len(createRefs)</span>
        
        <span class="c1">## self.persistentRefs holds all objects considered persistent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">persistentRefs</span><span class="p">)</span>
        
                
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------- Count changes since start: ----------&quot;</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="p">:</span>
            <span class="n">c1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">typs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1">#typs.sort(lambda a,b: cmp(c1[a], c1[b]))</span>
        <span class="n">typs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">c1</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">typs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">num</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------  </span><span class="si">%d</span><span class="s2"> Deleted since last diff: ------------&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">delRefs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">delRefs</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------  </span><span class="si">%d</span><span class="s2"> Created since last diff: ------------&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">createRefs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">createRefs</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------  </span><span class="si">%d</span><span class="s2"> Created since start (persistent): ------------&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">persistentRefs</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">persistentRefs</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>
        
        
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startCount</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">persistentRefs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">del</span> <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objs</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
            
<div class="viewcode-block" id="ObjTracker.isObjVar"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.isObjVar">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">isObjVar</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">cls</span> <span class="ow">or</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">allObjs</span></div>
            
<div class="viewcode-block" id="ObjTracker.collect"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Collecting list of all objects...&quot;</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="n">get_all_objects</span><span class="p">()</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">objs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">frame</span><span class="p">)]</span>  <span class="c1">## ignore the current frame </span>
        <span class="k">del</span> <span class="n">objs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="p">)]</span>
        
        <span class="n">ignoreTypes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>
        <span class="n">refs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">objs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ObjTracker</span><span class="o">.</span><span class="n">isObjVar</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">or</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">ignoreTypes</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">refs</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="n">typStr</span> <span class="o">=</span> <span class="n">typeStr</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objTypes</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">typStr</span>
            <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">typStr</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">count</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All objects: </span><span class="si">%d</span><span class="s2">   Tracked objects: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">refs</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">refs</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">objs</span></div>
        
<div class="viewcode-block" id="ObjTracker.forgetRef"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.forgetRef">[docs]</a>    <span class="k">def</span> <span class="nf">forgetRef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)]</span></div>
        
<div class="viewcode-block" id="ObjTracker.rememberRef"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.rememberRef">[docs]</a>    <span class="k">def</span> <span class="nf">rememberRef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="c1">## Record the address of the weakref object so it is not included in future object counts.</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ObjTracker</span><span class="o">.</span><span class="n">allObjs</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span></div>
            
        
<div class="viewcode-block" id="ObjTracker.lookup"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.lookup">[docs]</a>    <span class="k">def</span> <span class="nf">lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">objs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ref</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="n">objs</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">ref</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">obj</span></div>
                    
                    
<div class="viewcode-block" id="ObjTracker.report"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.report">[docs]</a>    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refs</span><span class="p">,</span> <span class="n">allobjs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showIDs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">allobjs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">allobjs</span> <span class="o">=</span> <span class="n">get_all_objects</span><span class="p">()</span>
        
        <span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rev</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">oid</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">refs</span><span class="p">[</span><span class="n">oid</span><span class="p">],</span> <span class="n">allobjs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">typ</span> <span class="o">=</span> <span class="s2">&quot;[del] &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objTypes</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">typ</span> <span class="o">=</span> <span class="n">typeStr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rev</span><span class="p">:</span>
                <span class="n">rev</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">rev</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">count</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">objectSize</span><span class="p">(</span><span class="n">obj</span><span class="p">)]</span>
        <span class="n">typs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1">#typs.sort(lambda a,b: cmp(count[a][1], count[b][1]))</span>
        <span class="n">typs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">count</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">typs</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;  </span><span class="si">%d</span><span class="se">\t</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">showIDs</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">rev</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ObjTracker.findTypes"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ObjTracker.findTypes">[docs]</a>    <span class="k">def</span> <span class="nf">findTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refs</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
        <span class="n">allObjs</span> <span class="o">=</span> <span class="n">get_all_objects</span><span class="p">()</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objTypes</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">refs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">allObjs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">objs</span></div></div>
        

    
    
<div class="viewcode-block" id="describeObj"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.describeObj">[docs]</a><span class="k">def</span> <span class="nf">describeObj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trace all reference paths backward, printing a list of different ways this object can be accessed.</span>
<span class="sd">    Attempts to answer the question &quot;who has a reference to this object&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ignore</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1">## holds IDs of objects used within the function.</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">())]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">refs</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">printed</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">refs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">path</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cyclic reference: &quot;</span> <span class="o">+</span> <span class="n">refPathString</span><span class="p">([</span><span class="n">ref</span><span class="p">]</span><span class="o">+</span><span class="n">path</span><span class="p">))</span>
            <span class="n">printed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="o">+</span><span class="n">path</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">depth</span><span class="p">:</span>
            <span class="n">refStr</span> <span class="o">=</span> <span class="n">refPathString</span><span class="p">(</span><span class="n">newPath</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;[_]&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">refStr</span><span class="p">:</span>           <span class="c1">## ignore &#39;_&#39; references generated by the interactive shell</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">refStr</span><span class="p">)</span>
            <span class="n">printed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">describeObj</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">newPath</span><span class="p">,</span> <span class="n">ignore</span><span class="p">)</span>
            <span class="n">printed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">printed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dead end: &quot;</span> <span class="o">+</span> <span class="n">refPathString</span><span class="p">(</span><span class="n">path</span><span class="p">))</span></div>
        
    
    
<div class="viewcode-block" id="typeStr"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.typeStr">[docs]</a><span class="k">def</span> <span class="nf">typeStr</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a more useful type string by making &lt;instance&gt; types report their class.&quot;&quot;&quot;</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="s1">&#39;InstanceType&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;instance of </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="searchRefs"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.searchRefs">[docs]</a><span class="k">def</span> <span class="nf">searchRefs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pseudo-interactive function for tracing references backward.</span>
<span class="sd">    **Arguments:**</span>
<span class="sd">    </span>
<span class="sd">        obj:   The initial object from which to start searching</span>
<span class="sd">        args:  A set of string or int arguments.</span>
<span class="sd">               each integer selects one of obj&#39;s referrers to be the new &#39;obj&#39;</span>
<span class="sd">               each string indicates an action to take on the current &#39;obj&#39;:</span>
<span class="sd">                  t:  print the types of obj&#39;s referrers</span>
<span class="sd">                  l:  print the lengths of obj&#39;s referrers (if they have __len__)</span>
<span class="sd">                  i:  print the IDs of obj&#39;s referrers</span>
<span class="sd">                  o:  print obj</span>
<span class="sd">                  ro: return obj</span>
<span class="sd">                  rr: return list of obj&#39;s referrers</span>
<span class="sd">    </span>
<span class="sd">    Examples::</span>
<span class="sd">    </span>
<span class="sd">       searchRefs(obj, &#39;t&#39;)                    ## Print types of all objects referring to obj</span>
<span class="sd">       searchRefs(obj, &#39;t&#39;, 0, &#39;t&#39;)            ##   ..then select the first referrer and print the types of its referrers</span>
<span class="sd">       searchRefs(obj, &#39;t&#39;, 0, &#39;t&#39;, &#39;l&#39;)       ##   ..also print lengths of the last set of referrers</span>
<span class="sd">       searchRefs(obj, 0, 1, &#39;ro&#39;)             ## Select index 0 from obj&#39;s referrer, then select index 1 from the next set of referrers, then return that object</span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ignore</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()):</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">refs</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        
        <span class="c1">#fo = allFrameObjs()</span>
        <span class="c1">#refs = [r for r in refs if r not in fo]</span>
        
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">refs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_referrers</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">ignore</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="n">refs</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">refs</span> <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">typeStr</span><span class="p">,</span> <span class="n">refs</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">refs</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">slen</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">slen</span><span class="p">,</span> <span class="n">refs</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;o&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;ro&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;rr&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">refs</span></div>
    
<div class="viewcode-block" id="allFrameObjs"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.allFrameObjs">[docs]</a><span class="k">def</span> <span class="nf">allFrameObjs</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return list of frame objects in current stack. Useful if you want to ignore these objects in refernece searches&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span>
    <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">f_code</span><span class="p">)</span>
        <span class="c1">#objs.append(f.f_locals)</span>
        <span class="c1">#objs.append(f.f_globals)</span>
        <span class="c1">#objs.append(f.f_builtins)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_back</span>
    <span class="k">return</span> <span class="n">objs</span></div>
        
    
<div class="viewcode-block" id="findObj"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.findObj">[docs]</a><span class="k">def</span> <span class="nf">findObj</span><span class="p">(</span><span class="n">regex</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a list of objects whose typeStr matches regex&quot;&quot;&quot;</span>
    <span class="n">allObjs</span> <span class="o">=</span> <span class="n">get_all_objects</span><span class="p">()</span>
    <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">allObjs</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">allObjs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">typeStr</span><span class="p">(</span><span class="n">obj</span><span class="p">)):</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">objs</span></div>
    


<div class="viewcode-block" id="listRedundantModules"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.listRedundantModules">[docs]</a><span class="k">def</span> <span class="nf">listRedundantModules</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;List modules that have been imported more than once via different paths.&quot;&quot;&quot;</span>
    <span class="n">mods</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s1">&#39;__file__&#39;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">mfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">mod</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mfile</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">mfile</span> <span class="o">=</span> <span class="n">mfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mfile</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;module at </span><span class="si">%s</span><span class="s2"> has 2 names: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mfile</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mods</span><span class="p">[</span><span class="n">mfile</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mods</span><span class="p">[</span><span class="n">mfile</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span></div>
            

<div class="viewcode-block" id="walkQObjectTree"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.walkQObjectTree">[docs]</a><span class="k">def</span> <span class="nf">walkQObjectTree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">counts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Walk through a tree of QObjects, doing nothing to them.</span>
<span class="sd">    The purpose of this function is to find dead objects and generate a crash</span>
<span class="sd">    immediately rather than stumbling upon them later.</span>
<span class="sd">    Prints a count of the objects encountered, for fun. (or is it?)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="o">*</span><span class="n">depth</span> <span class="o">+</span> <span class="n">typeStr</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="n">report</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">report</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">typ</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">children</span><span class="p">():</span>
        <span class="n">walkQObjectTree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">depth</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">counts</span></div>

<span class="n">QObjCache</span> <span class="o">=</span> <span class="p">{}</span>
<div class="viewcode-block" id="qObjectReport"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.qObjectReport">[docs]</a><span class="k">def</span> <span class="nf">qObjectReport</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a report counting all QObjects and their types&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">qObjCache</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">findObj</span><span class="p">(</span><span class="s1">&#39;PyQt&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
            <span class="n">oid</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">oid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">QObjCache</span><span class="p">:</span>
                <span class="n">QObjCache</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">=</span> <span class="n">typeStr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">QObjCache</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span>
                    <span class="n">QObjCache</span><span class="p">[</span><span class="n">oid</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;check obj&quot;</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">QObjCache</span><span class="p">[</span><span class="n">oid</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">walkQObjectTree</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
            
    <span class="n">typs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">typs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">typs</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="PrintDetector"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PrintDetector">[docs]</a><span class="k">class</span> <span class="nc">PrintDetector</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find code locations that print to stdout.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span>
    
<div class="viewcode-block" id="PrintDetector.remove"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PrintDetector.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span></div>
        
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    
<div class="viewcode-block" id="PrintDetector.write"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PrintDetector.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="PrintDetector.flush"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PrintDetector.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="listQThreads"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.listQThreads">[docs]</a><span class="k">def</span> <span class="nf">listQThreads</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Prints Thread IDs (Qt&#39;s, not OS&#39;s) for all QThreads.&quot;&quot;&quot;</span>
    <span class="n">thr</span> <span class="o">=</span> <span class="n">findObj</span><span class="p">(</span><span class="s1">&#39;[Tt]hread&#39;</span><span class="p">)</span>
    <span class="n">thr</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thr</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">)]</span>
    <span class="kn">import</span> <span class="nn">sip</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thr</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; &quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;     Qt ID: 0x</span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sip</span><span class="o">.</span><span class="n">unwrapinstance</span><span class="p">(</span><span class="n">t</span><span class="p">))</span></div>


<div class="viewcode-block" id="pretty"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.pretty">[docs]</a><span class="k">def</span> <span class="nf">pretty</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format nested dict/list/tuple structures into a more human-readable string</span>
<span class="sd">    This function is a bit better than pprint for displaying OrderedDicts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ind2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;    &quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">indent</span><span class="o">+</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">ind2</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:  &quot;</span> <span class="o">+</span> <span class="n">pretty</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span><span class="o">+</span><span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;[]&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;()&#39;</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">indent</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="n">ind2</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:  &quot;</span> <span class="o">+</span> <span class="n">pretty</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ind2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="n">indent</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span></div>


<div class="viewcode-block" id="PeriodicTrace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PeriodicTrace">[docs]</a><span class="k">class</span> <span class="nc">PeriodicTrace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Used to debug freezing by starting a new thread that reports on the </span>
<span class="sd">    location of the main thread periodically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PeriodicTrace.ReportThread"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PeriodicTrace.ReportThread">[docs]</a>    <span class="k">class</span> <span class="nc">ReportThread</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastInd</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Mutex</span><span class="p">()</span>
            <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="PeriodicTrace.ReportThread.notify"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PeriodicTrace.ReportThread.notify">[docs]</a>        <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="PeriodicTrace.ReportThread.run"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PeriodicTrace.ReportThread.run">[docs]</a>        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastInd</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;== Trace </span><span class="si">%d</span><span class="s2">: ==&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">)</span>
                        <span class="n">traceback</span><span class="o">.</span><span class="n">print_stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lastInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span></div></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainThread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">PeriodicTrace</span><span class="o">.</span><span class="n">ReportThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">)</span>

<div class="viewcode-block" id="PeriodicTrace.trace"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.PeriodicTrace.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainThread</span><span class="p">:</span> <span class="c1"># and &#39;threading&#39; not in frame.f_code.co_filename:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="c1"># print(&quot;== Trace ==&quot;, event, arg)</span>
            <span class="c1"># traceback.print_stack(frame)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span></div></div>



<div class="viewcode-block" id="ThreadColor"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ThreadColor">[docs]</a><span class="k">class</span> <span class="nc">ThreadColor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper on stdout/stderr that colors text by the current thread ID.</span>

<span class="sd">    *stream* must be &#39;stdout&#39; or &#39;stderr&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lock</span> <span class="o">=</span> <span class="n">Mutex</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err</span> <span class="o">=</span> <span class="n">stream</span> <span class="o">==</span> <span class="s1">&#39;stderr&#39;</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="ThreadColor.write"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ThreadColor.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">cprint</span><span class="o">.</span><span class="n">cprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">(),</span> <span class="n">msg</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">err</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThreadColor.flush"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ThreadColor.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreadColor.color"><a class="viewcode-back" href="../../../../../bornagain.external.pyqtgraph.pyqtgraph.debug.html#bornagain.external.pyqtgraph.pyqtgraph.debug.ThreadColor.color">[docs]</a>    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tid</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> <span class="o">%</span> <span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Richard A Kirian.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>