

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex, nofollow" />
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Numpy, vectors, rotations, etc. &mdash; bornagain 0.2018.9.9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="bornagain" href="modules.html" />
    <link rel="prev" title="Notes for Developers" href="coding.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> bornagain
          

          
          </a>

          
            
            
              <div class="version">
                0.2018.9.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Setting up bornagain</a></li>
<li class="toctree-l1"><a class="reference internal" href="beams.html">Beams</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="crystals.html">Working with crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding.html">Notes for Developers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Numpy, vectors, rotations, etc.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#indexing-and-internal-memory-layout-of-ndarray-objects">Indexing and internal memory layout of ndarray objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#arrays-of-vectors">Arrays of vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-rotate-vectors">How to rotate vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#representation-of-3d-density-intensity-maps-in-numpy-arrays">Representation of 3D density/intensity maps in numpy arrays</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">bornagain</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bornagain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Numpy, vectors, rotations, etc.</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/numpy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="numpy-vectors-rotations-etc">
<h1>Numpy, vectors, rotations, etc.<a class="headerlink" href="#numpy-vectors-rotations-etc" title="Permalink to this headline">¶</a></h1>
<p>We use numpy a lot, and there are a few important conventions within bornagain to be aware of.</p>
<div class="section" id="indexing-and-internal-memory-layout-of-ndarray-objects">
<h2>Indexing and internal memory layout of ndarray objects<a class="headerlink" href="#indexing-and-internal-memory-layout-of-ndarray-objects" title="Permalink to this headline">¶</a></h2>
<p>According to the <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/arrays.ndarray.html#internal-memory-layout-of-an-ndarray">docs</a>,
Numpy ndarray objects can accommodate any strided indexing scheme.  The bornagain package uses some
Fortran and OpenCL routines that make assumptions about the internal memory layout of ndarrays.  We assume that
all ndarrays are in the “c-contiguous order”, which means that incrmements in the right-most index correspond to the
smallest steps in the internal memory buffer.  The following example illustrates this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]])</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">c_contiguous</span><span class="p">)</span>
<span class="bp">True</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="arrays-of-vectors">
<h2>Arrays of vectors<a class="headerlink" href="#arrays-of-vectors" title="Permalink to this headline">¶</a></h2>
<p>If you have <em>N</em> vectors of dimension <em>D</em>, bornagain assumes they are stored with a shape of (<em>N</em>, <em>D</em>).  This choice was
made because the right-most index of a numpy array has the smallest stride by default, and because it usually makes
most sense to have vector components stored close to each other in memory.  This convention is assumed in every function
in bornagain.  This note is to avoid ambiguity in the case of a (<em>D</em>, <em>D</em>) array.</p>
</div>
<div class="section" id="how-to-rotate-vectors">
<h2>How to rotate vectors<a class="headerlink" href="#how-to-rotate-vectors" title="Permalink to this headline">¶</a></h2>
<p>If you need to rotate a vector or an array of vectors with the matrix <em>R</em>, you can do the following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vec_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">vec</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>The above is equivalent to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vec_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also use the <a class="reference internal" href="bornagain.utils.html#bornagain.utils.rotate" title="bornagain.utils.rotate"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate</span></code></a> function for consistency.  Here is what you should expect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]])</span>
<span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">vec_rotated</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">vec_rotated</span><span class="p">)</span>

  <span class="p">[</span> <span class="mf">2.</span> <span class="o">-</span><span class="mf">1.</span>  <span class="mf">3.</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that the <a class="reference internal" href="bornagain.utils.html#bornagain.utils.rotate" title="bornagain.utils.rotate"><code class="xref py py-func docutils literal notranslate"><span class="pre">rotate</span></code></a> function carried out via numpy is consistent with rotation
operations performed on GPU devices within the <a class="reference internal" href="bornagain.simulate.clcore.html#module-bornagain.simulate.clcore" title="bornagain.simulate.clcore"><code class="xref py py-mod docutils literal notranslate"><span class="pre">simulate.clcore</span></code></a> module.</p>
</div>
<div class="section" id="representation-of-3d-density-intensity-maps-in-numpy-arrays">
<h2>Representation of 3D density/intensity maps in numpy arrays<a class="headerlink" href="#representation-of-3d-density-intensity-maps-in-numpy-arrays" title="Permalink to this headline">¶</a></h2>
<p>This needs to be specified some day…</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="bornagain" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coding.html" class="btn btn-neutral" title="Notes for Developers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2018.9.9',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>