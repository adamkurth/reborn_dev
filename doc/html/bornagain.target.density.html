

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta name="robots" content="noindex, nofollow" />
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>bornagain.target.density module &mdash; bornagain 0.2018.9.9 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="bornagain.target.molecule module" href="bornagain.target.molecule.html" />
    <link rel="prev" title="bornagain.target.crystal module" href="bornagain.target.crystal.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> bornagain
          

          
          </a>

          
            
            
              <div class="version">
                0.2018.9.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Setting up bornagain</a></li>
<li class="toctree-l1"><a class="reference internal" href="beams.html">Beams</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="crystals.html">Working with crystals</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="coding.html">Notes for Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy.html">Numpy, vectors, rotations, etc.</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">bornagain</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="bornagain.html">bornagain package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="bornagain.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="bornagain.analysis.html">bornagain.analysis package</a></li>
<li class="toctree-l4"><a class="reference internal" href="bornagain.external.html">bornagain.external package</a></li>
<li class="toctree-l4"><a class="reference internal" href="bornagain.fileio.html">bornagain.fileio package</a></li>
<li class="toctree-l4"><a class="reference internal" href="bornagain.simulate.html">bornagain.simulate package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="bornagain.target.html">bornagain.target package</a></li>
<li class="toctree-l4"><a class="reference internal" href="bornagain.viewers.html">bornagain.viewers package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="bornagain.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bornagain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="modules.html">bornagain</a> &raquo;</li>
        
          <li><a href="bornagain.html">bornagain package</a> &raquo;</li>
        
          <li><a href="bornagain.target.html">bornagain.target package</a> &raquo;</li>
        
      <li>bornagain.target.density module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/bornagain.target.density.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-bornagain.target.density">
<span id="bornagain-target-density-module"></span><h1>bornagain.target.density module<a class="headerlink" href="#module-bornagain.target.density" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="bornagain.target.density.DensityMap">
<em class="property">class </em><code class="descclassname">bornagain.target.density.</code><code class="descname">DensityMap</code><span class="sig-paren">(</span><em>shape=None</em>, <em>corner_min=None</em>, <em>corner_max=None</em>, <em>deltas=None</em>, <em>molecule=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#DensityMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.DensityMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.shape">
<code class="descname">shape</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.shape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.corner_min">
<code class="descname">corner_min</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.corner_min" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.deltas">
<code class="descname">deltas</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.deltas" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.corner_max">
<code class="descname">corner_max</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.corner_max" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.n_voxels">
<code class="descname">n_voxels</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.n_voxels" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.dx">
<code class="descname">dx</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.dx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.strides">
<code class="descname">strides</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.DensityMap.strides" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.DensityMap.n_vecs">
<code class="descname">n_vecs</code><a class="headerlink" href="#bornagain.target.density.DensityMap.n_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Get an Nx3 array of vectors corresponding to the indices of the map voxels.  The array looks like this</em> – [[0,0,0],[0,0,1],[0,0,2], … ,[N-1,N-1,N-1]]</p>
<p>Returns: numpy array</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="bornagain.target.density.CrystalDensityMap">
<em class="property">class </em><code class="descclassname">bornagain.target.density.</code><code class="descname">CrystalDensityMap</code><span class="sig-paren">(</span><em>cryst</em>, <em>resolution</em>, <em>oversampling</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A helper class for working with 3D density maps.  Most importantly, it allows one to do spacegroup symmetry
transformations.  Once provided information about a crystal (spacegroup, lattice), along with desired resolution and
oversampling ratio, this tool intelligently chooses the shape of the map and creates lookup tables for the symmetry
transformations.  It also produces the Fourier-space frequency samples that are helpful when connecting direct
all-atom simulations with FFTs.  In general, the maps are cubic NxNxN array.  This class does not maintain the data
array; it provides methods needed to work on the data arrays.</p>
<p>Importantly, this class is focused on operations in the crystal basis, because the symmetry operations are most
elegant in that basis.</p>
<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.sym_luts">
<code class="descname">sym_luts</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.sym_luts" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.n_vecs">
<code class="descname">n_vecs</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.n_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Get an Nx3 array of vectors corresponding to the indices of the map voxels.  The array looks like this</em> – [[0,0,0],[0,0,1],[0,0,2], … ,[N-1,N-1,N-1]]</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.x_vecs">
<code class="descname">x_vecs</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.x_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an Nx3 array of vectors in the crystal basis.  If there were four samples per unit cell, the array looks a
bit like this:</p>
<p>[[0,0,0],[0,0,0.25],[0,0,0.5],[0,0,0.75],[0,0.25,0], … ,[0.75,0.75,0.75]]</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.limits">
<code class="descname">limits</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.limits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.corner_min">
<code class="descname">corner_min</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.corner_min" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.corner_max">
<code class="descname">corner_max</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.corner_max" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.corner">
<code class="descname">corner</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.corner" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.x_limits">
<code class="descname">x_limits</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.x_limits" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a 3x2 array with the limits of the density map.  These limits correspond to the centers of the voxels.</p>
<p>Returns:</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.r_vecs">
<code class="descname">r_vecs</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.r_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an Nx3 array of 3-vectors contain the Cartesian-basis vectors of each voxel in the map.  This is done
by taking the crystal-basis position vectors x, and applying the orthogonalization matrix O to them.</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.h_vecs">
<code class="descname">h_vecs</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.h_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides an Nx3 array of Fourier-space vectors “h”.  These coordinates can be understood as “fractional
Miller indices” that coorespond to the density samples upon taking an FFT of the real-space map.  With atomic
coordinates x (in the crystal basis) one can take the Fourier transform F(h) = sum_n f_n exp(i h*x)</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.h_limits">
<code class="descname">h_limits</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.h_limits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.h_corner">
<code class="descname">h_corner</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.h_corner" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.h_deltas">
<code class="descname">h_deltas</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.h_deltas" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.h_density_map">
<code class="descname">h_density_map</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.h_density_map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalDensityMap.q_vecs">
<code class="descname">q_vecs</code><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.q_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides an Nx3 array of momentum-transfer vectors (with the usual 2 pi factor).</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.get_sym_luts">
<code class="descname">get_sym_luts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.get_sym_luts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.get_sym_luts" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides a list of “symmetry transform lookup tables”.  These are the linearized array indices. For a
transformation that consists of an identity matrix along with zero translation, the lut is just an array
p = [0,1,2,3,…,N^3-1].  Other transforms are like a “scrambling” of that ordering, such that a remapping of
density samples is done with an operation like this: newmap.flat[p2] = oldmap.flat[p1].   Note that the luts are
kept in memory for future use - beware of the memory requirement.</p>
<p>Returns: list of numpy arrays</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.symmetry_transform">
<code class="descname">symmetry_transform</code><span class="sig-paren">(</span><em>i</em>, <em>j</em>, <em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.symmetry_transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.symmetry_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>This applies symmetry transformations to a data array (i.e. density map).  The crystal spacegroup gives rise
to Ns symmetry transformation operations (e.g. each operation consists of a rotation matrix paired with
translation vector).  Of those Ns symmetry transformations, this function will take a map from the ith
configuration to the jth configuration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>i</strong> (<em>int</em>) – The “from” index; symmetry transforms are performed from this index to the j index</li>
<li><strong>j</strong> (<em>int</em>) – The “to” index; symmetry transforms are performed from the i index to this index</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: A transformed data array (i.e. density map)</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.reshape">
<code class="descname">reshape</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.reshape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>For convenience, this will reshape a data array to the shape NxNxN.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – the data array</td>
</tr>
</tbody>
</table>
<p>Returns: the same data array as the input, but with shape NxNxN</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.reshape3">
<code class="descname">reshape3</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.reshape3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.reshape3" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – A data array of length 3*N^3 that consists of 3-vectors (one for each density voxel)</td>
</tr>
</tbody>
</table>
<p>Returns: A re-shaped data array of shape NxNxNx3</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.zeros">
<code class="descname">zeros</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.zeros" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenience function: simply returns an array of zeros of shape NxNxN</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.place_atoms_in_map">
<code class="descname">place_atoms_in_map</code><span class="sig-paren">(</span><em>atom_x_vecs</em>, <em>atom_fs</em>, <em>mode='gaussian'</em>, <em>fixed_atom_sigma=5e-11</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.place_atoms_in_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.place_atoms_in_map" title="Permalink to this definition">¶</a></dt>
<dd><p>This will take a list of atom position vectors and densities and place them in a 3D map.  The position vectors
should be in the crystal basis, and the densities must be real (because the scipy function that we use does
not allow for complex numbers…).  This is done in a lazy way - the density samples are placed in the nearest
voxel.  There are no Gaussian shapes asigned to the atomic form.  Nothing fancy…</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>atom_x_vecs</strong> (<em>numpy array</em>) – An nx3 array of position vectors</li>
<li><strong>atom_fs</strong> (<em>numpy array</em>) – An n-length array of densities (must be real)</li>
<li><strong>mode</strong> (<em>str</em>) – Either ‘gaussian’ or ‘nearest’</li>
<li><strong>fixed_atom_sigma</strong> (<em>float</em>) – Standard deviation of</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: An NxNxN numpy array containing the sum of densities that were provided as input.</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalDensityMap.place_intensities_in_map">
<code class="descname">place_intensities_in_map</code><span class="sig-paren">(</span><em>h</em>, <em>f</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalDensityMap.place_intensities_in_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalDensityMap.place_intensities_in_map" title="Permalink to this definition">¶</a></dt>
<dd><p>This will take a list of Miller index vectors and intensities and place them in a 3D map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>h</strong> (<em>numpy array</em>) – An Nx3 array of hkl vectors</li>
<li><strong>f</strong> (<em>numpy array</em>) – An N-length array of intensities (must be real)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: An NxNxN numpy array containing the sum of densities that were provided as input.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="bornagain.target.density.CrystalMeshTool">
<em class="property">class </em><code class="descclassname">bornagain.target.density.</code><code class="descname">CrystalMeshTool</code><span class="sig-paren">(</span><em>cryst</em>, <em>resolution</em>, <em>oversampling</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A helper class for working with 3D density maps.  Most importantly, it allows one to do spacegroup symmetry
transformations.  Once provided information about a crystal (spacegroup, lattice), along with desired resolution and
oversampling ratio, this tool intelligently chooses the shape of the map and creates lookup tables for the symmetry
transformations.  It also produces the Fourier-space frequency samples that are helpful when connecting direct
all-atom simulations with FFTs.  In general, the maps are cubic NxNxN array.  This class does not maintain the data
array; it provides methods needed to work on the data arrays.</p>
<p>Importantly, this class is focused on operations in the crystal basis, because the symmetry operations are most
elegant in that basis.</p>
<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.sym_luts">
<code class="descname">sym_luts</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.sym_luts" title="Permalink to this definition">¶</a></dt>
<dd><p>Cached lookup tables</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.cryst1">
<code class="descname">cryst1</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.cryst1" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.cryst">
<code class="descname">cryst</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.cryst" title="Permalink to this definition">¶</a></dt>
<dd><p>crystal.target class object used to initiate the map</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.s">
<code class="descname">s</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.s" title="Permalink to this definition">¶</a></dt>
<dd><p>Oversampling ratio</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.d">
<code class="descname">d</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.d" title="Permalink to this definition">¶</a></dt>
<dd><p>Length-3 array of “actual” resolutions (different from “requested” resolution)</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.dx">
<code class="descname">dx</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.dx" title="Permalink to this definition">¶</a></dt>
<dd><p>Crystal basis length increment</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.Nc">
<code class="descname">Nc</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.Nc" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of samples along edge of unit cell</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.N">
<code class="descname">N</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of samples along edge of whole map (includes oversampling)</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.P">
<code class="descname">P</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.P" title="Permalink to this definition">¶</a></dt>
<dd><p>Linear length fo map (=N^3)</p>
</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.CrystalMeshTool.w">
<code class="descname">w</code><em class="property"> = None</em><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.w" title="Permalink to this definition">¶</a></dt>
<dd><p>The stride vector (mostly for internal use)</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_n_vecs">
<code class="descname">get_n_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_n_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_n_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an Nx3 array of vectors corresponding to the indices of the map voxels.  The array looks like this:</p>
<p>[[0,0,0],[0,0,1],[0,0,2], … ,[N-1,N-1,N-1]]</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_x_vecs">
<code class="descname">get_x_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_x_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_x_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an Nx3 array of vectors in the crystal basis.  If there were four samples per unit cell, the array looks a
bit like this:</p>
<p>[[0,0,0],[0,0,0.25],[0,0,0.5],[0,0,0.75],[0,0.25,0], … ,[0.75,0.75,0.75]]</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_r_vecs">
<code class="descname">get_r_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_r_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_r_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an Nx3 array of 3-vectors contain the Cartesian-basis vectors of each voxel in the map.  This is done
by taking the crystal-basis position vectors x, and applying the orthogonalization matrix O to them.</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_h_vecs">
<code class="descname">get_h_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_h_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_h_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides an Nx3 array of Fourier-space vectors “h”.  These coordinates can be understood as “fractional
Miller indices” that coorespond to the density samples upon taking an FFT of the real-space map.  With atomic
coordinates x (in the crystal basis) one can take the Fourier transform F(h) = sum_n f_n exp(i h*x)</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_q_vecs">
<code class="descname">get_q_vecs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_q_vecs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_q_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides an Nx3 array of momentum-transfer vectors (with the usual 2 pi factor).</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.get_sym_luts">
<code class="descname">get_sym_luts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.get_sym_luts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.get_sym_luts" title="Permalink to this definition">¶</a></dt>
<dd><p>This provides a list of “symmetry transform lookup tables”.  These are the linearized array indices. For a
transformation that consists of an identity matrix along with zero translation, the lut is just an array
p = [0,1,2,3,…,N^3-1].  Other transforms are like a “scrambling” of that ordering, such that a remapping of
density samples is done with an operation like this: newmap.flat[p2] = oldmap.flat[p1].   Note that the luts are
kept in memory for future use - beware of the memory requirement.</p>
<p>Returns: list of numpy arrays</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.symmetry_transform">
<code class="descname">symmetry_transform</code><span class="sig-paren">(</span><em>i</em>, <em>j</em>, <em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.symmetry_transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.symmetry_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>This applies symmetry transformations to a data array (i.e. density map).  The crystal spacegroup gives rise
to Ns symmetry transformation operations (e.g. each operation consists of a rotation matrix paired with
translation vector).  Of those Ns symmetry transformations, this function will take a map from the ith
configuration to the jth configuration.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>i</strong> (<em>int</em>) – The “from” index; symmetry transforms are performed from this index to the j index</li>
<li><strong>j</strong> (<em>int</em>) – The “to” index; symmetry transforms are performed from the i index to this index</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: A transformed data array (i.e. density map)</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.shape">
<code class="descname">shape</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>For convenience, return the map shape [N,N,N]</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.reshape">
<code class="descname">reshape</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.reshape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>For convenience, this will reshape a data array to the shape NxNxN.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – the data array</td>
</tr>
</tbody>
</table>
<p>Returns: the same data array as the input, but with shape NxNxN</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.reshape3">
<code class="descname">reshape3</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.reshape3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.reshape3" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – A data array of length 3*N^3 that consists of 3-vectors (one for each density voxel)</td>
</tr>
</tbody>
</table>
<p>Returns: A re-shaped data array of shape NxNxNx3</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.zeros">
<code class="descname">zeros</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.zeros" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenience function: simply returns an array of zeros of shape NxNxN</p>
<p>Returns: numpy array</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.place_atoms_in_map">
<code class="descname">place_atoms_in_map</code><span class="sig-paren">(</span><em>atom_x_vecs</em>, <em>atom_fs</em>, <em>mode='gaussian'</em>, <em>fixed_atom_sigma=5e-11</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.place_atoms_in_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.place_atoms_in_map" title="Permalink to this definition">¶</a></dt>
<dd><p>This will take a list of atom position vectors and densities and place them in a 3D map.  The position vectors
should be in the crystal basis, and the densities must be real (because the scipy function that we use does
not allow for complex numbers…).
There are currently two modes - one mode, called ‘gaussian’, places Guassian atoms of a fixed width and sums them
to form the density map. The other mode, called ‘nearest’, just placed the atom Z values in the nearest
voxel. Both of these modes will need to be replaced with something more realistic later, probably based on the
Cromer-Mann coefficients.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>x</strong> (<em>numpy array</em>) – An nx3 array of position vectors</li>
<li><strong>f</strong> (<em>numpy array</em>) – An n-length array of densities (must be real)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: An NxNxN numpy array containing the sum of densities that were provided as input.</p>
</dd></dl>

<dl class="method">
<dt id="bornagain.target.density.CrystalMeshTool.place_intensities_in_map">
<code class="descname">place_intensities_in_map</code><span class="sig-paren">(</span><em>h</em>, <em>f</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#CrystalMeshTool.place_intensities_in_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.CrystalMeshTool.place_intensities_in_map" title="Permalink to this definition">¶</a></dt>
<dd><p>This will take a list of Miller index vectors and intensities and place them in a 3D map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>h</strong> (<em>numpy array</em>) – An Nx3 array of hkl vectors</li>
<li><strong>f</strong> (<em>numpy array</em>) – An N-length array of intensities (must be real)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: An NxNxN numpy array containing the sum of densities that were provided as input.</p>
</dd></dl>

</dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.place_atoms_in_map">
<code class="descclassname">bornagain.target.density.</code><code class="descname">place_atoms_in_map</code><a class="reference internal" href="_modules/bornagain/target/density.html#place_atoms_in_map"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.place_atoms_in_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Needs documentation…</p>
</dd></dl>

<dl class="function">
<dt id="bornagain.target.density.trilinear_interpolation_fortran">
<code class="descclassname">bornagain.target.density.</code><code class="descname">trilinear_interpolation_fortran</code><span class="sig-paren">(</span><em>densities</em>, <em>vectors</em>, <em>corners</em>, <em>deltas</em>, <em>out</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#trilinear_interpolation_fortran"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.trilinear_interpolation_fortran" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="bornagain.target.density.trilinear_interpolation">
<code class="descclassname">bornagain.target.density.</code><code class="descname">trilinear_interpolation</code><span class="sig-paren">(</span><em>densities</em>, <em>vectors</em>, <em>corners</em>, <em>deltas</em>, <em>out=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#trilinear_interpolation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.trilinear_interpolation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="bornagain.target.density.trilinear_interpolation_numba">
<code class="descclassname">bornagain.target.density.</code><code class="descname">trilinear_interpolation_numba</code><a class="reference internal" href="_modules/bornagain/target/density.html#trilinear_interpolation_numba"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.trilinear_interpolation_numba" title="Permalink to this definition">¶</a></dt>
<dd><p>Trilinear interpolation of a 3D map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>densities</strong> – A 3D array of shape AxBxC</li>
<li><strong>vectors</strong> – An Nx3 array of 3-vectors</li>
<li><strong>limits</strong> – A 3x2 array specifying the limits of the density map samples.  These values specify the voxel centers.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns: Array of intensities with length N.</p>
</dd></dl>

<dl class="function">
<dt id="bornagain.target.density.trilinear_insertion">
<code class="descclassname">bornagain.target.density.</code><code class="descname">trilinear_insertion</code><span class="sig-paren">(</span><em>densities</em>, <em>weights</em>, <em>vectors</em>, <em>vals</em>, <em>corners</em>, <em>deltas</em>, <em>weight=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/bornagain/target/density.html#trilinear_insertion"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#bornagain.target.density.trilinear_insertion" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bornagain.target.molecule.html" class="btn btn-neutral float-right" title="bornagain.target.molecule module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bornagain.target.crystal.html" class="btn btn-neutral" title="bornagain.target.crystal module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2018.9.9',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>